# 81. Cross-Component Communication with Outputs

> Duração: `9min`

Sem Recursos

WEBVTT

1
00:00:00.360 --> 00:00:01.830
<v Maximilian>So we got this</v>

2
00:00:01.830 --> 00:00:05.520
calculate investment results method in the app component.

3
00:00:05.520 --> 00:00:08.820
And we're expecting a data object here,

4
00:00:08.820 --> 00:00:10.170
which we then destructure

5
00:00:10.170 --> 00:00:13.530
to pull out the initial investment hands-on.

6
00:00:13.530 --> 00:00:15.840
As a next step, we therefore must make sure

7
00:00:15.840 --> 00:00:18.090
that this gets invoked

8
00:00:18.090 --> 00:00:22.500
and it should get invoked when this button here is pressed,

9
00:00:22.500 --> 00:00:23.883
this calculate button.

10
00:00:24.780 --> 00:00:27.510
The problem just is that this button, of course,

11
00:00:27.510 --> 00:00:29.190
is in a different component.

12
00:00:29.190 --> 00:00:32.613
It's in the user input component, not the app component.

13
00:00:33.630 --> 00:00:36.330
Now, we could of course, move this method

14
00:00:36.330 --> 00:00:38.370
into the user input component,

15
00:00:38.370 --> 00:00:41.580
but I actually want to keep it here in the app component

16
00:00:41.580 --> 00:00:45.090
because we'll soon add that results component

17
00:00:45.090 --> 00:00:47.940
that should output the table with the results.

18
00:00:47.940 --> 00:00:51.150
And I plan on inserting that results component

19
00:00:51.150 --> 00:00:53.310
in the app component template,

20
00:00:53.310 --> 00:00:55.350
which means we need to get access

21
00:00:55.350 --> 00:00:57.330
to the calculated results here

22
00:00:57.330 --> 00:00:59.670
in order to pass them into that

23
00:00:59.670 --> 00:01:02.550
to be added results component.

24
00:01:02.550 --> 00:01:04.530
So we'll need access to the results

25
00:01:04.530 --> 00:01:06.960
in the app component anyways soon,

26
00:01:06.960 --> 00:01:09.873
hence it makes sense to calculate them there.

27
00:01:11.010 --> 00:01:12.720
So I want to keep that method here.

28
00:01:12.720 --> 00:01:15.960
I don't wanna move it into the user input component,

29
00:01:15.960 --> 00:01:17.910
and therefore we need to find another way

30
00:01:17.910 --> 00:01:20.790
of communicating from that user input component

31
00:01:20.790 --> 00:01:22.830
to the app component.

32
00:01:22.830 --> 00:01:24.420
And you did learn

33
00:01:24.420 --> 00:01:27.930
how you can communicate from a child component,

34
00:01:27.930 --> 00:01:32.220
which the user input component is to the app component,

35
00:01:32.220 --> 00:01:35.430
to the parent component of that child component.

36
00:01:35.430 --> 00:01:38.850
So from the user input component to the app component,

37
00:01:38.850 --> 00:01:39.813
in this case.

38
00:01:41.580 --> 00:01:45.210
You can communicate by emitting a custom event.

39
00:01:45.210 --> 00:01:47.460
And that's what we'll do here.

40
00:01:47.460 --> 00:01:51.000
So in the user input component TypeScript file,

41
00:01:51.000 --> 00:01:52.650
we can add a new property,

42
00:01:52.650 --> 00:01:55.710
which we will turn into a custom event

43
00:01:55.710 --> 00:01:57.930
by using any name of our choice

44
00:01:57.930 --> 00:02:00.510
though it should be a fitting event name,

45
00:02:00.510 --> 00:02:03.093
like for example, calculate.

46
00:02:04.170 --> 00:02:06.810
And now you got two different ways

47
00:02:06.810 --> 00:02:11.810
of making this a custom event, of making this an output,

48
00:02:11.940 --> 00:02:13.770
as it's called an Angular.

49
00:02:13.770 --> 00:02:16.923
You can either call the output function,

50
00:02:18.000 --> 00:02:20.700
which must be imported from Angular core,

51
00:02:20.700 --> 00:02:25.700
which can only be used if you're using Angular 17.3

52
00:02:25.710 --> 00:02:30.710
or higher, or you manually create an event emitter here,

53
00:02:33.030 --> 00:02:35.490
which also must be imported from Angular core,

54
00:02:35.490 --> 00:02:37.140
but which has been around forever

55
00:02:37.140 --> 00:02:40.050
and which is the approach you'll see

56
00:02:40.050 --> 00:02:42.210
in more Angular projects.

57
00:02:42.210 --> 00:02:43.743
Hence I'll use that here.

58
00:02:44.760 --> 00:02:48.990
And you then also need to decorate this property here

59
00:02:48.990 --> 00:02:51.690
with @output.

60
00:02:51.690 --> 00:02:54.753
So with this output decorator like this,

61
00:02:55.830 --> 00:02:59.073
which also must be imported from Angular core,

62
00:03:00.420 --> 00:03:02.310
this decorator is only needed

63
00:03:02.310 --> 00:03:04.650
if you're using the event emitter here.

64
00:03:04.650 --> 00:03:07.080
If you're instead using the output function,

65
00:03:07.080 --> 00:03:09.120
you don't need the decorator

66
00:03:09.120 --> 00:03:11.163
and you shouldn't be using it then.

67
00:03:13.650 --> 00:03:16.110
Now it is considered a good practice to make it clear

68
00:03:16.110 --> 00:03:18.870
which kind of data will be emitted here.

69
00:03:18.870 --> 00:03:22.680
And you do that by adding angle brackets after event emitter

70
00:03:22.680 --> 00:03:24.270
before the parentheses.

71
00:03:24.270 --> 00:03:25.950
And then between those angle brackets,

72
00:03:25.950 --> 00:03:29.190
you put the type definition of the type of data

73
00:03:29.190 --> 00:03:30.333
that will be emitted.

74
00:03:31.440 --> 00:03:34.620
And here I actually wanna emit data

75
00:03:34.620 --> 00:03:37.410
that has this shape here.

76
00:03:37.410 --> 00:03:40.890
I wanna omit an object that has these properties,

77
00:03:40.890 --> 00:03:42.303
which are all numbers.

78
00:03:43.680 --> 00:03:46.560
So we can copy this type definition here

79
00:03:46.560 --> 00:03:49.410
from the app component TypeScript file,

80
00:03:49.410 --> 00:03:52.083
and insert it here between the angle brackets.

81
00:03:53.490 --> 00:03:58.170
Since this is a non-trivial type though,

82
00:03:58.170 --> 00:04:01.500
it's a bit longer, a bit more code,

83
00:04:01.500 --> 00:04:03.810
we could also consider putting this

84
00:04:03.810 --> 00:04:08.220
into a separate model though, a separate type definition,

85
00:04:08.220 --> 00:04:10.530
which we could then reuse.

86
00:04:10.530 --> 00:04:12.780
And I'll do that soon but for the moment,

87
00:04:12.780 --> 00:04:14.130
I'll just copy and paste it

88
00:04:14.130 --> 00:04:16.923
to focus on outputting the event for now.

89
00:04:18.330 --> 00:04:20.670
So we got that calculate output.

90
00:04:20.670 --> 00:04:23.560
We can now use that here in on submit

91
00:04:24.450 --> 00:04:27.840
to call, calculate, or this.calculate

92
00:04:27.840 --> 00:04:30.423
since it's a property of the class, of course.

93
00:04:31.440 --> 00:04:34.770
This.calculate.emit

94
00:04:34.770 --> 00:04:37.887
and you do that no matter if you manually create created

95
00:04:37.887 --> 00:04:41.883
the event emitter or if you used the output function.

96
00:04:44.370 --> 00:04:47.730
Well and then we have to emit an object of that shape.

97
00:04:47.730 --> 00:04:51.420
So an object that has all these properties,

98
00:04:51.420 --> 00:04:55.350
initial investment, duration, expected return,

99
00:04:55.350 --> 00:05:00.150
and annual investment and the values now of course

100
00:05:00.150 --> 00:05:02.880
should be the values entered by the user,

101
00:05:02.880 --> 00:05:06.570
but transformed to a number.

102
00:05:06.570 --> 00:05:10.560
And you can easily and quickly transform a string value

103
00:05:10.560 --> 00:05:14.010
to a number in Angular by simply adding a plus

104
00:05:14.010 --> 00:05:15.630
in front of it.

105
00:05:15.630 --> 00:05:19.980
So plus this entered initial investment,

106
00:05:19.980 --> 00:05:23.103
for example, here, for the initial investment property.

107
00:05:25.530 --> 00:05:30.530
For the duration, it's therefore plus this entered duration.

108
00:05:31.860 --> 00:05:33.120
For the expected return,

109
00:05:33.120 --> 00:05:38.120
it's plus this entered expected return

110
00:05:38.640 --> 00:05:41.460
and for the annual investment, you guessed it,

111
00:05:41.460 --> 00:05:45.543
it's plus this entered annual investment.

112
00:05:46.380 --> 00:05:50.400
And with that we'll emit this event, this output,

113
00:05:50.400 --> 00:05:54.213
and send this data, this object along with it.

114
00:05:56.400 --> 00:05:59.880
Now as a last step to finally trigger

115
00:05:59.880 --> 00:06:02.670
this calculate investment results function

116
00:06:02.670 --> 00:06:06.060
in the app component, we just have to listen

117
00:06:06.060 --> 00:06:07.743
to that emitted event.

118
00:06:08.730 --> 00:06:12.120
We can do that in the app component template

119
00:06:12.120 --> 00:06:14.070
by using event binding

120
00:06:14.070 --> 00:06:17.190
and then here I get this smart suggestion

121
00:06:17.190 --> 00:06:20.403
so by binding it to the calculate output event.

122
00:06:21.660 --> 00:06:24.630
Now we need to define which code should be executed

123
00:06:24.630 --> 00:06:26.040
when that event occurs.

124
00:06:26.040 --> 00:06:27.264
And here I want to call

125
00:06:27.264 --> 00:06:31.110
this calculate investment results method,

126
00:06:31.110 --> 00:06:33.180
or actually to be in line

127
00:06:33.180 --> 00:06:37.710
with how I always name these event handling methods.

128
00:06:37.710 --> 00:06:41.370
I'll name it on calculate investment results.

129
00:06:41.370 --> 00:06:43.470
This is not technically required,

130
00:06:43.470 --> 00:06:45.723
just a convention I adopted.

131
00:06:47.790 --> 00:06:50.490
So it's on calculate investment results,

132
00:06:50.490 --> 00:06:52.263
which should be executed here.

133
00:06:53.820 --> 00:06:54.960
Now, I'm getting an error here

134
00:06:54.960 --> 00:06:57.930
because of course on calculate investment results

135
00:06:57.930 --> 00:07:01.383
expects one argument, but I'm not passing any data to it.

136
00:07:02.490 --> 00:07:05.160
And of course, I wanna pass along that data,

137
00:07:05.160 --> 00:07:06.750
which I emitted.

138
00:07:06.750 --> 00:07:09.300
You also learned how you can do that.

139
00:07:09.300 --> 00:07:12.960
You can use the special dollar sign event variable,

140
00:07:12.960 --> 00:07:15.330
which is made available by Angular

141
00:07:15.330 --> 00:07:19.890
when using event binding to take that event data

142
00:07:19.890 --> 00:07:24.890
that was attached to the emitted custom event to the output,

143
00:07:25.260 --> 00:07:28.440
and then use it in any way you wanna use it.

144
00:07:28.440 --> 00:07:31.260
In this case, I'll send it as an argument

145
00:07:31.260 --> 00:07:33.873
to on calculate investment results.

146
00:07:35.490 --> 00:07:39.360
And now as a last step to check whether this worked,

147
00:07:39.360 --> 00:07:42.510
I'll actually replace this return statement here.

148
00:07:42.510 --> 00:07:44.220
Since currently there's no one

149
00:07:44.220 --> 00:07:47.370
who would be interested in returned data,

150
00:07:47.370 --> 00:07:50.790
I'll replace it by console logging

151
00:07:50.790 --> 00:07:53.040
this calculated annual data

152
00:07:53.040 --> 00:07:55.863
to see whether it looks all right or not.

153
00:07:59.040 --> 00:08:02.040
So that was a lot of work but with that, if you save it all,

154
00:08:02.040 --> 00:08:07.040
if you reload and you enter some data here, like this maybe,

155
00:08:09.750 --> 00:08:11.460
and you click calculate,

156
00:08:11.460 --> 00:08:13.950
you should see some annual data here

157
00:08:13.950 --> 00:08:16.980
and array with multiple rows,

158
00:08:16.980 --> 00:08:19.620
multiple entries, one for every year.

159
00:08:19.620 --> 00:08:24.000
Since I have a duration of 10 years, I got 10 entries here.

160
00:08:24.000 --> 00:08:27.870
And then for every year, you see the annual investment,

161
00:08:27.870 --> 00:08:31.380
the interest gained in that year, the total amount invested,

162
00:08:31.380 --> 00:08:33.210
which is the initial investment

163
00:08:33.210 --> 00:08:36.870
and the accumulated annual investments.

164
00:08:36.870 --> 00:08:39.510
The total interest gained up to this point.

165
00:08:39.510 --> 00:08:43.140
So the accumulated interest over all the years

166
00:08:43.140 --> 00:08:46.020
and the value of the investment at the end of the year,

167
00:08:46.020 --> 00:08:48.963
which is the amount investment plus the interest.

168
00:08:50.040 --> 00:08:54.090
And that, of course, should update in a correct way

169
00:08:54.090 --> 00:08:56.400
for every year.

170
00:08:56.400 --> 00:08:58.980
So that's looking good to me here,

171
00:08:58.980 --> 00:09:02.280
and therefore we got one way of calculating

172
00:09:02.280 --> 00:09:03.510
that annual data.

173
00:09:03.510 --> 00:09:07.440
The next step now, of course, is to output it on the screen

174
00:09:07.440 --> 00:09:10.410
before we then thereafter we'll explore

175
00:09:10.410 --> 00:09:13.560
how we could use a service instead of doing it here

176
00:09:13.560 --> 00:09:14.670
in the app component.

177
00:09:14.670 --> 00:09:18.240
But first, let's make sure that we output this annual data,

178
00:09:18.240 --> 00:09:21.360
not just in the console, but instead on the screen

179
00:09:21.360 --> 00:09:23.223
in a table below the input.

