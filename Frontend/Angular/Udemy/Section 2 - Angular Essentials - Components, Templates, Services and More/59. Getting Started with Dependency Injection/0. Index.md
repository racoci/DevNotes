# 59. Getting Started with Dependency Injection

> Duração: `8min`

Sem Recursos

WEBVTT

1
00:00:00.480 --> 00:00:02.760
<v Maximilian>Now, of course we now need access</v>

2
00:00:02.760 --> 00:00:04.170
to this class

3
00:00:04.170 --> 00:00:07.530
or to an object that's based on this class

4
00:00:07.530 --> 00:00:10.770
so that we can get hold of our tasks again.

5
00:00:10.770 --> 00:00:15.060
And therefore, as a first step, we should export this class

6
00:00:15.060 --> 00:00:18.633
so that we can use it somewhere else in our application.

7
00:00:19.860 --> 00:00:23.760
Now we can go to the tasks.component.ts file,

8
00:00:23.760 --> 00:00:28.263
and we can import this newly added service here.

9
00:00:29.100 --> 00:00:34.080
So this tasks service, we can import it from

10
00:00:34.080 --> 00:00:36.333
the tasks.service file.

11
00:00:38.070 --> 00:00:40.230
Now this is a class

12
00:00:40.230 --> 00:00:43.290
and therefore a blueprint for an object.

13
00:00:43.290 --> 00:00:47.130
So in order to interact with it and use these methods

14
00:00:47.130 --> 00:00:49.200
and so on, we actually have

15
00:00:49.200 --> 00:00:52.143
to instantiate this service first.

16
00:00:53.100 --> 00:00:56.520
And we could do that by adding a new property,

17
00:00:56.520 --> 00:00:58.560
potentially a private property,

18
00:00:58.560 --> 00:01:02.820
which is only meant to be used in this component class here

19
00:01:02.820 --> 00:01:05.040
that could be named tasksService,

20
00:01:05.040 --> 00:01:07.560
and where we do then instantiate

21
00:01:07.560 --> 00:01:09.603
this tasksService like this.

22
00:01:10.680 --> 00:01:12.720
And then for example here, when we want

23
00:01:12.720 --> 00:01:16.830
to get our selectedUserTasks, we could do that

24
00:01:16.830 --> 00:01:18.640
by reaching out to this tasksService

25
00:01:19.620 --> 00:01:20.970
and by calling getUserTasks

26
00:01:22.200 --> 00:01:26.673
and by then passing this.userId to this method.

27
00:01:28.290 --> 00:01:31.773
But this approach has a huge problem.

28
00:01:32.880 --> 00:01:37.470
If we instantiate this class here like this,

29
00:01:37.470 --> 00:01:39.800
then we'll have one instance

30
00:01:39.800 --> 00:01:42.870
of this service in this component.

31
00:01:42.870 --> 00:01:45.240
But if we then want to use the service

32
00:01:45.240 --> 00:01:47.610
in another component as well,

33
00:01:47.610 --> 00:01:50.910
we would create a separate independent instance

34
00:01:50.910 --> 00:01:52.260
of that service there.

35
00:01:52.260 --> 00:01:56.493
We would not be sharing that one object that we create here.

36
00:01:57.600 --> 00:01:59.700
And the implication of that is

37
00:01:59.700 --> 00:02:02.190
that if we then change the data

38
00:02:02.190 --> 00:02:06.270
that's managed by that service in another component,

39
00:02:06.270 --> 00:02:08.940
those changes wouldn't be reflected here

40
00:02:08.940 --> 00:02:13.350
because we would be operating on different instances

41
00:02:13.350 --> 00:02:14.763
of that tasksService.

42
00:02:17.220 --> 00:02:21.210
That's why Angular gives you another powerful tool

43
00:02:21.210 --> 00:02:25.200
which is used in conjunction with services,

44
00:02:25.200 --> 00:02:28.650
and that's a tool called dependency injection,

45
00:02:28.650 --> 00:02:31.350
which is a quite common mechanism,

46
00:02:31.350 --> 00:02:35.640
especially when working with object oriented programming.

47
00:02:35.640 --> 00:02:38.880
And the idea behind dependency injection is

48
00:02:38.880 --> 00:02:42.900
that you don't create this instance on your own,

49
00:02:42.900 --> 00:02:45.420
but that you instead tell Angular

50
00:02:45.420 --> 00:02:47.340
that you need such an instance

51
00:02:47.340 --> 00:02:50.580
and you let Angular create it.

52
00:02:50.580 --> 00:02:54.720
And therefore Angular can create this instance once,

53
00:02:54.720 --> 00:02:57.540
and you can then use this one instance

54
00:02:57.540 --> 00:02:59.040
in different components,

55
00:02:59.040 --> 00:03:03.480
and therefore you would then be operating on the same data.

56
00:03:03.480 --> 00:03:05.460
So how do we then tell Angular

57
00:03:05.460 --> 00:03:07.290
that we want such an instance?

58
00:03:07.290 --> 00:03:10.800
Well, for example, by adding the constructor function

59
00:03:10.800 --> 00:03:14.220
to this class, which is a special method

60
00:03:14.220 --> 00:03:17.340
which you can add to any class in JavaScript,

61
00:03:17.340 --> 00:03:19.980
which will automatically be executed

62
00:03:19.980 --> 00:03:23.430
when this class here is instantiated,

63
00:03:23.430 --> 00:03:26.700
which will happen automatically by Angular

64
00:03:26.700 --> 00:03:29.463
whenever this component is used in some template.

65
00:03:30.330 --> 00:03:33.660
So this constructor will be executed automatically

66
00:03:33.660 --> 00:03:36.990
and it will be Angular that executes it in the end

67
00:03:36.990 --> 00:03:41.100
because it will be Angular that instantiates this component.

68
00:03:41.100 --> 00:03:45.330
Therefore, you tell Angular about the dependency you need

69
00:03:45.330 --> 00:03:50.330
by simply adding it here as a parameter to this constructor.

70
00:03:50.520 --> 00:03:53.910
So here we could add this tasksService parameter,

71
00:03:53.910 --> 00:03:58.050
and by then giving it a type of TasksService,

72
00:03:58.050 --> 00:03:59.970
we let Angular know

73
00:03:59.970 --> 00:04:04.970
that we need this service instance here in this component.

74
00:04:05.400 --> 00:04:09.750
That's how Angular's dependency injection mechanism works.

75
00:04:09.750 --> 00:04:13.560
You specify your dependencies in your constructor function,

76
00:04:13.560 --> 00:04:17.550
and by clearly defining the type of the parameter you want,

77
00:04:17.550 --> 00:04:21.540
Angular is able to look up the class of that type

78
00:04:21.540 --> 00:04:24.660
and create it for you, so to say.

79
00:04:24.660 --> 00:04:27.540
Now, of course, to make this tasksService

80
00:04:27.540 --> 00:04:29.250
available in the rest of the class,

81
00:04:29.250 --> 00:04:31.740
we then have to store it in a property,

82
00:04:31.740 --> 00:04:34.650
and therefore we can either bring back our private

83
00:04:34.650 --> 00:04:36.570
tasksService property,

84
00:04:36.570 --> 00:04:40.050
which is of type TasksService like this,

85
00:04:40.050 --> 00:04:42.910
and then set it in the constructor body

86
00:04:44.940 --> 00:04:46.230
like this

87
00:04:46.230 --> 00:04:49.650
so that we store the received argument

88
00:04:49.650 --> 00:04:52.023
in this tasksService property.

89
00:04:53.280 --> 00:04:57.360
Or we take a shortcut that's offered by TypeScript

90
00:04:57.360 --> 00:05:00.840
and we get rid of the property and the constructor body,

91
00:05:00.840 --> 00:05:03.300
and we instead add private

92
00:05:03.300 --> 00:05:06.180
or public if it should be publicly available,

93
00:05:06.180 --> 00:05:08.070
but here private is enough,

94
00:05:08.070 --> 00:05:10.800
in front of this parameter,

95
00:05:10.800 --> 00:05:13.740
and that will then automatically create a property

96
00:05:13.740 --> 00:05:15.810
of the same name.

97
00:05:15.810 --> 00:05:17.310
It's simply a shortcut

98
00:05:17.310 --> 00:05:19.350
that's provided by TypeScript

99
00:05:19.350 --> 00:05:21.180
so that this common pattern

100
00:05:21.180 --> 00:05:24.060
of storing a parameter in a property

101
00:05:24.060 --> 00:05:25.623
gets a bit more convenient.

102
00:05:26.490 --> 00:05:30.603
And with that, we can then finally get our user tasks.

103
00:05:31.890 --> 00:05:34.830
However, we're not entirely there yet

104
00:05:34.830 --> 00:05:38.670
because by adding this code, we let Angular know

105
00:05:38.670 --> 00:05:41.823
that we need an object of type TasksService,

106
00:05:42.780 --> 00:05:46.650
and Angular then will look for such a class,

107
00:05:46.650 --> 00:05:49.080
but it will not magically scan

108
00:05:49.080 --> 00:05:51.153
all your files and folders again.

109
00:05:52.080 --> 00:05:54.510
Instead, you need to register

110
00:05:54.510 --> 00:05:58.170
this TasksService, this class here,

111
00:05:58.170 --> 00:06:02.310
as something injectable with Angular

112
00:06:02.310 --> 00:06:05.340
so that Angular knows that it can be injected

113
00:06:05.340 --> 00:06:06.510
and that it should look

114
00:06:06.510 --> 00:06:10.050
for this thing when encountering a dependency

115
00:06:10.050 --> 00:06:11.193
like we have it here.

116
00:06:12.300 --> 00:06:14.220
And we do register this class

117
00:06:14.220 --> 00:06:16.590
as injectable with Angular

118
00:06:16.590 --> 00:06:19.410
by adding another decorator to it,

119
00:06:19.410 --> 00:06:22.410
the Injectable decorator,

120
00:06:22.410 --> 00:06:25.683
which is imported from @angular/core.

121
00:06:27.780 --> 00:06:30.330
You add this by executing it like a function

122
00:06:30.330 --> 00:06:33.633
and by then passing a configuration object to it.

123
00:06:34.650 --> 00:06:36.750
And in this configuration object,

124
00:06:36.750 --> 00:06:41.130
it's this providedIn option that should be set

125
00:06:41.130 --> 00:06:44.010
and you should set it to root.

126
00:06:44.010 --> 00:06:47.220
Now, just as with all these other essential concepts,

127
00:06:47.220 --> 00:06:49.530
we'll dive deeper into services

128
00:06:49.530 --> 00:06:53.640
and dependency injection a little bit later in the course.

129
00:06:53.640 --> 00:06:57.000
But for most cases, it's this syntax here,

130
00:06:57.000 --> 00:06:57.960
which you need,

131
00:06:57.960 --> 00:07:02.013
in order to make a class, a service, injectable.

132
00:07:03.300 --> 00:07:05.640
By adding this decorator like this,

133
00:07:05.640 --> 00:07:08.460
Angular now is aware of this service

134
00:07:08.460 --> 00:07:11.580
and can create such an instance when you need it.

135
00:07:11.580 --> 00:07:14.250
And most importantly, it will only create

136
00:07:14.250 --> 00:07:16.410
and reuse one instance

137
00:07:16.410 --> 00:07:18.390
so that different components

138
00:07:18.390 --> 00:07:21.270
operate on the same object in memory

139
00:07:21.270 --> 00:07:23.583
and therefore on the same data.

140
00:07:24.600 --> 00:07:27.660
Therefore, here, if you now save this,

141
00:07:27.660 --> 00:07:29.850
the app will not fully work yet,

142
00:07:29.850 --> 00:07:31.530
but if you select a user,

143
00:07:31.530 --> 00:07:33.720
you at least see those dummy tasks.

144
00:07:33.720 --> 00:07:37.740
And as you can see, they are fetched on a per user basis,

145
00:07:37.740 --> 00:07:41.490
and we only see the tasks of a given user.

146
00:07:41.490 --> 00:07:45.810
So that is working and we are using that service.

147
00:07:45.810 --> 00:07:47.880
But now of course, we want to use

148
00:07:47.880 --> 00:07:50.220
that service in multiple components

149
00:07:50.220 --> 00:07:52.170
because that's one of the main reasons

150
00:07:52.170 --> 00:07:53.910
for adding such a service

151
00:07:53.910 --> 00:07:56.550
that we can make our component classes lean

152
00:07:56.550 --> 00:08:00.633
and reuse that logic in different places of our application.

