# 62. Using localStorage for Data Storage

> Duração: `6min`

Sem Recursos

WEBVTT

1
00:00:00.750 --> 00:00:03.540
<v Maximilian>So now that you also got an introduction</v>

2
00:00:03.540 --> 00:00:07.020
to services and dependency injection,

3
00:00:07.020 --> 00:00:10.050
you really have a solid foundation

4
00:00:10.050 --> 00:00:13.050
about all the core Angular essentials

5
00:00:13.050 --> 00:00:15.660
every Angular developer needs to know.

6
00:00:15.660 --> 00:00:18.030
Before we conclude this module, though,

7
00:00:18.030 --> 00:00:20.460
there's one last little enhancement

8
00:00:20.460 --> 00:00:22.590
that we could make to this application

9
00:00:22.590 --> 00:00:23.850
because at the moment,

10
00:00:23.850 --> 00:00:26.640
it works such that all the changes we make,

11
00:00:26.640 --> 00:00:30.300
all the tasks we add or we mark as completed,

12
00:00:30.300 --> 00:00:32.980
are lost whenever we reload

13
00:00:34.050 --> 00:00:37.560
because we're only working with some dummy data

14
00:00:37.560 --> 00:00:39.210
that's stored in memory

15
00:00:39.210 --> 00:00:43.323
and that's always recreated when the app restarts therefore.

16
00:00:44.310 --> 00:00:46.620
And we could improve this app

17
00:00:46.620 --> 00:00:51.620
by storing at least the tasks in a more persistent storage.

18
00:00:52.320 --> 00:00:54.990
Now, later in the course, you will learn

19
00:00:54.990 --> 00:00:59.160
how to connect your Angular application to a backend,

20
00:00:59.160 --> 00:01:00.720
so to a server,

21
00:01:00.720 --> 00:01:04.200
where data could be stored in a real database.

22
00:01:04.200 --> 00:01:05.730
But for the moment here,

23
00:01:05.730 --> 00:01:08.850
I'll just store that data in the browser storage,

24
00:01:08.850 --> 00:01:11.073
which is better than nothing, I guess.

25
00:01:12.240 --> 00:01:15.870
So the idea is to fetch the tasks

26
00:01:15.870 --> 00:01:20.220
from the browser storage when the app loads,

27
00:01:20.220 --> 00:01:24.690
and to update the tasks stored in the browser storage

28
00:01:24.690 --> 00:01:27.123
whenever we add or remove a task,

29
00:01:28.080 --> 00:01:30.900
and I'll start with the initialization.

30
00:01:30.900 --> 00:01:35.263
For that, we can add a constructor here to this TasksService

31
00:01:36.420 --> 00:01:38.430
because as you learned, that's a function

32
00:01:38.430 --> 00:01:41.493
that's automatically executed when the app starts.

33
00:01:42.510 --> 00:01:46.200
And in there, we could set this.tasks array

34
00:01:46.200 --> 00:01:51.200
equal to data that we fetch from local storage.

35
00:01:51.690 --> 00:01:55.230
Now, I'll actually do that with help of a helper constant,

36
00:01:55.230 --> 00:01:58.020
where I reach out to localStorage

37
00:01:58.020 --> 00:02:00.660
and where I then call getItem

38
00:02:00.660 --> 00:02:03.390
to get some data from local storage,

39
00:02:03.390 --> 00:02:07.320
which should be stored under a key of tasks.

40
00:02:07.320 --> 00:02:10.380
So the assumption is that in the browser's local storage,

41
00:02:10.380 --> 00:02:14.130
we're storing some tasks with a key of tasks.

42
00:02:14.130 --> 00:02:17.700
Next, I wanna check if some tasks were found,

43
00:02:17.700 --> 00:02:20.070
and if I did find some tasks,

44
00:02:20.070 --> 00:02:22.560
so if some data was stored there,

45
00:02:22.560 --> 00:02:26.160
which will not be the case when we run this code

46
00:02:26.160 --> 00:02:29.670
for the first time, but if we do have some tasks,

47
00:02:29.670 --> 00:02:32.640
then I wanna overwrite my tasks here

48
00:02:32.640 --> 00:02:34.953
with the tasks from local storage.

49
00:02:36.090 --> 00:02:39.330
However, the tasks we retrieve from local storage,

50
00:02:39.330 --> 00:02:42.780
this constant here, will always be a string

51
00:02:42.780 --> 00:02:46.140
because we can't store complex values like arrays

52
00:02:46.140 --> 00:02:48.900
or objects in local storage like this.

53
00:02:48.900 --> 00:02:52.140
Instead, we have to convert them to JSON first,

54
00:02:52.140 --> 00:02:55.470
which in the end is a string that has a certain format.

55
00:02:55.470 --> 00:02:58.980
So the assumption is that the tasks, if they exist,

56
00:02:58.980 --> 00:03:01.530
will be stored in that JSON format,

57
00:03:01.530 --> 00:03:05.040
which is a standard format in programming.

58
00:03:05.040 --> 00:03:09.690
And therefore, here, I'll actually parse the tasks as JSON

59
00:03:09.690 --> 00:03:11.730
to convert them back to an array.

60
00:03:11.730 --> 00:03:13.203
That's the idea here.

61
00:03:14.370 --> 00:03:17.850
So I keep my dummy tasks if no tasks are found,

62
00:03:17.850 --> 00:03:21.330
but if tasks are found, I'll use those instead.

63
00:03:21.330 --> 00:03:22.653
That's the idea here.

64
00:03:23.910 --> 00:03:26.460
Well, and now we need to update the tasks

65
00:03:26.460 --> 00:03:29.013
whenever we save or remove a task.

66
00:03:29.940 --> 00:03:32.730
And therefore, I'll add another helper method here,

67
00:03:32.730 --> 00:03:35.640
a private method, which is only meant to be used

68
00:03:35.640 --> 00:03:40.317
from inside this service class, which I'll name saveTasks.

69
00:03:42.127 --> 00:03:46.157
And here, I will simply call localStorage.setItem

70
00:03:47.961 --> 00:03:51.060
and set an item with a key of tasks,

71
00:03:51.060 --> 00:03:54.510
because that's also the key we're looking for

72
00:03:54.510 --> 00:03:56.643
when retrieving the tasks here.

73
00:03:59.220 --> 00:04:02.430
And I wanna store my tasks array here.

74
00:04:02.430 --> 00:04:07.430
So I will now use JSON.stringify to convert this.tasks,

75
00:04:08.970 --> 00:04:12.690
the tasks array that's currently managed by this service,

76
00:04:12.690 --> 00:04:15.810
to such a string in the JSON format.

77
00:04:15.810 --> 00:04:19.560
And that will then be stored in local storage.

78
00:04:19.560 --> 00:04:23.010
And now we just have to call this.saveTasks

79
00:04:23.010 --> 00:04:24.660
after removing a task

80
00:04:24.660 --> 00:04:27.933
and after adding a task in both places.

81
00:04:30.690 --> 00:04:34.470
Well, and with that, if you now save that and reload,

82
00:04:34.470 --> 00:04:37.770
you'll see the tasks are still there.

83
00:04:37.770 --> 00:04:39.840
But if I now complete a task

84
00:04:39.840 --> 00:04:42.600
and I therefore change my tasks,

85
00:04:42.600 --> 00:04:46.110
you can see if you use the browser developer tools

86
00:04:46.110 --> 00:04:50.580
and you go to the application tab that under local storage,

87
00:04:50.580 --> 00:04:53.280
there is a tasks key here,

88
00:04:53.280 --> 00:04:55.750
and the value under that key

89
00:04:56.670 --> 00:05:01.670
is now actually this string with the tasks in this format.

90
00:05:02.670 --> 00:05:04.020
It might not look like a string,

91
00:05:04.020 --> 00:05:06.543
but it is stored in a string in the end.

92
00:05:08.880 --> 00:05:11.400
So the data is stored and therefore indeed,

93
00:05:11.400 --> 00:05:14.550
if I reload, we can see that for Marcus here,

94
00:05:14.550 --> 00:05:16.410
we only have one task now

95
00:05:16.410 --> 00:05:18.270
because we're now using the tasks

96
00:05:18.270 --> 00:05:20.313
that are loaded from local storage.

97
00:05:21.420 --> 00:05:25.110
And this isn't an Angular-specific feature

98
00:05:25.110 --> 00:05:26.490
or anything like that,

99
00:05:26.490 --> 00:05:28.350
but I think it's a nice enhancement

100
00:05:28.350 --> 00:05:30.900
for this first demo app here,

101
00:05:30.900 --> 00:05:32.850
which now allowed us to explore

102
00:05:32.850 --> 00:05:35.730
all those crucial Angular essentials

103
00:05:35.730 --> 00:05:38.373
every Angular developer must know.

