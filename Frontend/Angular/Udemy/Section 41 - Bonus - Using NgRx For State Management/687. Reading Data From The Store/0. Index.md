# 687. Reading Data From The Store

> Duração: `10min`

## Recursos
- 05-selecting-data-from-store.zip
- 05-selecting-data-from-store-standalone.zip

WEBVTT

1
00:00:02.040 --> 00:00:03.930
<v Instructor>So we got our Reducer function,</v>

2
00:00:03.930 --> 00:00:06.090
no matter how it was created,

3
00:00:06.090 --> 00:00:09.900
and we're providing it to the application in the end

4
00:00:09.900 --> 00:00:11.940
by setting up this Store.

5
00:00:11.940 --> 00:00:14.430
Now before diving into Actions

6
00:00:14.430 --> 00:00:17.490
and making sure that the Reducer does a bit more

7
00:00:17.490 --> 00:00:20.220
than just defining some initial State

8
00:00:20.220 --> 00:00:22.950
I wanna show you how you can read that data

9
00:00:22.950 --> 00:00:27.303
that's managed by this Reducer in the end from this Store.

10
00:00:28.500 --> 00:00:31.440
And therefore, here, in this application,

11
00:00:31.440 --> 00:00:35.040
where I have to counter output Component, for example,

12
00:00:35.040 --> 00:00:36.720
I want to go to that Component,

13
00:00:36.720 --> 00:00:39.120
and in that Component I wanna output

14
00:00:39.120 --> 00:00:41.190
to currently stored counter

15
00:00:41.190 --> 00:00:43.233
in the template of this Component.

16
00:00:44.340 --> 00:00:48.060
To do that here in the counter output Component,

17
00:00:48.060 --> 00:00:52.200
I will get rid of this counterService that I'm injecting,

18
00:00:52.200 --> 00:00:56.148
and I can therefore also get rid of ngOnDestroy

19
00:00:56.148 --> 00:00:57.873
and ngOnInit here.

20
00:00:58.860 --> 00:01:03.480
And instead we can now inject the Store

21
00:01:03.480 --> 00:01:05.640
and that will be of type Store.

22
00:01:05.640 --> 00:01:09.993
And this then should be imported from @ngrx/store.

23
00:01:12.150 --> 00:01:14.730
Now this Store, which I'm injecting here,

24
00:01:14.730 --> 00:01:18.360
will be this one globally managed Store.

25
00:01:18.360 --> 00:01:22.290
So this Store thing, this Store object,

26
00:01:22.290 --> 00:01:24.450
that's managed by NgRx.

27
00:01:24.450 --> 00:01:26.850
And we can inject this Store

28
00:01:26.850 --> 00:01:30.600
because we are providing it here.

29
00:01:30.600 --> 00:01:31.440
And it's the same,

30
00:01:31.440 --> 00:01:33.330
if you're using Standalone Components.

31
00:01:33.330 --> 00:01:37.050
There, the Store is also being created and provided.

32
00:01:37.050 --> 00:01:39.510
In this case in the main.ts file,

33
00:01:39.510 --> 00:01:41.370
and therefore there as well.

34
00:01:41.370 --> 00:01:44.190
In the counter output Component

35
00:01:44.190 --> 00:01:47.180
you could get rid of ngOnInit and ngOnDestroy

36
00:01:48.480 --> 00:01:50.730
and get rid of this counterService.

37
00:01:50.730 --> 00:01:54.390
And instead simply inject the Store

38
00:01:54.390 --> 00:01:57.753
which is imported from @ngrx/store.

39
00:01:58.950 --> 00:02:00.000
And therefore of course

40
00:02:00.000 --> 00:02:02.760
you can also get rid of this counterService import,

41
00:02:02.760 --> 00:02:05.760
no matter if you're using Standalone Components

42
00:02:05.760 --> 00:02:08.100
or Angular modules.

43
00:02:08.100 --> 00:02:10.770
But that's of course not all that should be done here.

44
00:02:10.770 --> 00:02:13.230
Instead, what's typically done next

45
00:02:13.230 --> 00:02:15.840
is that you get rid of these properties

46
00:02:15.840 --> 00:02:18.930
which I used before for getting my counter.

47
00:02:18.930 --> 00:02:23.310
And instead I'll add one new property to my class here,

48
00:02:23.310 --> 00:02:25.470
to my counter output Component class

49
00:02:25.470 --> 00:02:28.320
and I'll name it count dollar sign at the end.

50
00:02:28.320 --> 00:02:31.350
Now the dollar sign is technically not important,

51
00:02:31.350 --> 00:02:33.420
but it is a convention you will see

52
00:02:33.420 --> 00:02:35.910
in some Angular projects,

53
00:02:35.910 --> 00:02:40.710
that you decorate properties with a dollar sign at the end

54
00:02:40.710 --> 00:02:44.940
if those properties in the end Store an observable.

55
00:02:44.940 --> 00:02:46.770
And indeed, that's what I'll do here.

56
00:02:46.770 --> 00:02:50.670
I will Store an observable in here.

57
00:02:50.670 --> 00:02:52.680
And again, it would absolutely work

58
00:02:52.680 --> 00:02:54.420
without that dollar sign,

59
00:02:54.420 --> 00:02:57.180
but since you'll see this in some Angular projects,

60
00:02:57.180 --> 00:02:59.193
I will add the dollar sign here.

61
00:03:00.180 --> 00:03:04.530
Now observable is being imported from rxjs.

62
00:03:04.530 --> 00:03:08.400
The subscription import is not needed anymore though.

63
00:03:08.400 --> 00:03:11.430
And this observable will in the end yield a number,

64
00:03:11.430 --> 00:03:14.250
because my counter will in the end be a number.

65
00:03:14.250 --> 00:03:18.093
So we can add this extra annotation here to make that clear.

66
00:03:20.130 --> 00:03:23.430
Now where do we set this observable though?

67
00:03:23.430 --> 00:03:25.590
Well, we can do this in the constructor.

68
00:03:25.590 --> 00:03:29.730
There we can assign a value to the count observable.

69
00:03:29.730 --> 00:03:33.420
And the value I wanna assign is store,

70
00:03:33.420 --> 00:03:37.890
so using this injected Store argument here,

71
00:03:37.890 --> 00:03:40.950
dot and then select,

72
00:03:40.950 --> 00:03:44.220
because that's how you can read data from the Store.

73
00:03:44.220 --> 00:03:46.500
This select method, which is provided

74
00:03:46.500 --> 00:03:48.600
on this injected Store object,

75
00:03:48.600 --> 00:03:53.550
and keep in mind that this Store object is coming from NgRx.

76
00:03:53.550 --> 00:03:54.810
So this select method,

77
00:03:54.810 --> 00:03:56.490
which you can call on the Store object,

78
00:03:56.490 --> 00:03:59.790
allows you to select data from the Store.

79
00:03:59.790 --> 00:04:03.180
And to select, you can then pass your key

80
00:04:03.180 --> 00:04:05.850
that identifies the data you wanna select

81
00:04:05.850 --> 00:04:10.850
and that's the key you used for storing your Reducer.

82
00:04:10.980 --> 00:04:15.980
So here in this case, in this Store, I pass this object,

83
00:04:16.050 --> 00:04:19.980
this map of Reducers to forRoot.

84
00:04:19.980 --> 00:04:21.750
And that will then behind the scenes

85
00:04:21.750 --> 00:04:24.840
construct a Store that combines all the data

86
00:04:24.840 --> 00:04:26.970
from all these Reducers.

87
00:04:26.970 --> 00:04:29.010
And these different pieces of data

88
00:04:29.010 --> 00:04:32.250
that are coming from these different Reducers

89
00:04:32.250 --> 00:04:36.510
will be stored in that one global Store object

90
00:04:36.510 --> 00:04:38.760
by using those keys.

91
00:04:38.760 --> 00:04:42.570
So these keys which you used here for assigning the Reducer

92
00:04:42.570 --> 00:04:46.380
can be used for extracting the data from that Store,

93
00:04:46.380 --> 00:04:49.650
so the data that's managed by this Reducer.

94
00:04:49.650 --> 00:04:53.310
So in my case here, I wanna select counter here.

95
00:04:53.310 --> 00:04:55.590
I wanna select counter from my Store

96
00:04:55.590 --> 00:04:58.950
because I used the counter key here.

97
00:04:58.950 --> 00:05:00.600
And again, it does not matter

98
00:05:00.600 --> 00:05:03.453
whether you are using Standalone Components or not.

99
00:05:04.830 --> 00:05:07.290
Now here I'm getting some TypeScript error,

100
00:05:07.290 --> 00:05:09.150
because here in this Component,

101
00:05:09.150 --> 00:05:11.250
the TypeScript doesn't understand

102
00:05:11.250 --> 00:05:14.790
that my Store will have this counter key.

103
00:05:14.790 --> 00:05:18.180
Now I know it as a developer because I set it up,

104
00:05:18.180 --> 00:05:21.603
but TypeScript doesn't know it in this file here.

105
00:05:22.530 --> 00:05:23.940
Therefore, what's recommended

106
00:05:23.940 --> 00:05:27.660
is that you add some generic type annotation

107
00:05:27.660 --> 00:05:29.730
to this Store type here,

108
00:05:29.730 --> 00:05:32.850
and you there define the shape of your Store.

109
00:05:32.850 --> 00:05:36.390
In this case here, counter: number.

110
00:05:36.390 --> 00:05:39.780
So here I'm telling TypeScript that my Store

111
00:05:39.780 --> 00:05:43.620
will in the end be an object that will have a counter key

112
00:05:43.620 --> 00:05:45.870
because I use counter as a key here

113
00:05:45.870 --> 00:05:48.150
for assigning the Reducer.

114
00:05:48.150 --> 00:05:50.760
And that the value that will be stored in my Store

115
00:05:50.760 --> 00:05:55.170
under that key will be a number, and it will be a number

116
00:05:55.170 --> 00:05:57.870
because here in this app my counter Reducer

117
00:05:57.870 --> 00:06:00.240
will in the end return a number.

118
00:06:00.240 --> 00:06:01.800
It will always return a number

119
00:06:01.800 --> 00:06:04.443
because my counter State here is a number.

120
00:06:05.400 --> 00:06:07.560
So therefore I'm adding this type annotation.

121
00:06:07.560 --> 00:06:10.773
And with that, I can successfully select my counter.

122
00:06:11.640 --> 00:06:14.730
Now when selecting values from the Store,

123
00:06:14.730 --> 00:06:18.450
you're not getting the values themselves though.

124
00:06:18.450 --> 00:06:20.520
Instead, what you are getting

125
00:06:20.520 --> 00:06:22.320
is an Observable.

126
00:06:22.320 --> 00:06:24.840
Select yields an Observable.

127
00:06:24.840 --> 00:06:28.440
That's why I'm storing an Observable here in count.

128
00:06:28.440 --> 00:06:30.600
And the advantage of this is

129
00:06:30.600 --> 00:06:32.880
that it will automatically be updated

130
00:06:32.880 --> 00:06:35.280
whenever the data in the Store changes.

131
00:06:35.280 --> 00:06:36.840
So if the data changes there,

132
00:06:36.840 --> 00:06:39.720
this Component can listen to that change

133
00:06:39.720 --> 00:06:41.493
and can update the UI.

134
00:06:42.510 --> 00:06:45.150
Now, we could do this manually now

135
00:06:45.150 --> 00:06:49.350
by simply calling subscribe and managing some property

136
00:06:49.350 --> 00:06:50.760
in this Component

137
00:06:50.760 --> 00:06:54.360
and then unsubscribe in ngOnDestroy and so on.

138
00:06:54.360 --> 00:06:55.920
That would all be fine.

139
00:06:55.920 --> 00:07:00.240
But we can also leverage a special pipe

140
00:07:00.240 --> 00:07:03.483
that's provided by Angular, the AsyncPipe.

141
00:07:05.040 --> 00:07:08.610
Here in the counter output Component template file,

142
00:07:08.610 --> 00:07:11.910
I can use my count$ variable,

143
00:07:11.910 --> 00:07:14.820
which as you learned contains an observable,

144
00:07:14.820 --> 00:07:17.884
and use the built-in AsyncPipe on it

145
00:07:17.884 --> 00:07:22.830
to set up an automatic listener to this observable

146
00:07:22.830 --> 00:07:25.440
that will update this part of the UI

147
00:07:25.440 --> 00:07:28.410
whenever the observable changes.

148
00:07:28.410 --> 00:07:31.203
So that's a convenient feature built into Angular.

149
00:07:32.280 --> 00:07:35.400
And we'll ignore this part down here for the moment.

150
00:07:35.400 --> 00:07:39.540
I'll just get rid of this and we'll fix it later.

151
00:07:39.540 --> 00:07:42.360
But that's how we can listen to an observable

152
00:07:42.360 --> 00:07:45.420
in the template and unwrap the latest value

153
00:07:45.420 --> 00:07:48.660
and update this part whenever the value changes.

154
00:07:48.660 --> 00:07:51.303
And how we can select data from the Store.

155
00:07:52.320 --> 00:07:54.327
Now I can also get rid of the OnInit

156
00:07:54.327 --> 00:07:57.723
and OnDestroy interfaces and off these imports.

157
00:07:58.710 --> 00:08:01.110
And I'll now copy over that code

158
00:08:01.110 --> 00:08:03.270
to my counter output Component

159
00:08:03.270 --> 00:08:05.880
that uses Standalone Components.

160
00:08:05.880 --> 00:08:09.570
I'll also get rid of those interfaces here.

161
00:08:09.570 --> 00:08:13.560
I will import Observable from rxjs,

162
00:08:13.560 --> 00:08:15.660
and with that we're selecting data

163
00:08:15.660 --> 00:08:18.000
in this Component as well.

164
00:08:18.000 --> 00:08:21.820
And then there we also want to use the AsyncPipe

165
00:08:23.250 --> 00:08:26.340
like this and get rid of this.

166
00:08:26.340 --> 00:08:29.400
Since it's a Standalone Component here though,

167
00:08:29.400 --> 00:08:33.330
we also must make sure that the AsyncPipe is available

168
00:08:33.330 --> 00:08:36.840
by adding imports to the counter output Component there,

169
00:08:36.840 --> 00:08:41.373
and by then importing the AsyncPipe from @angular/common.

170
00:08:42.270 --> 00:08:45.753
Add this import and add it to the imports array here.

171
00:08:47.160 --> 00:08:48.240
With that, however,

172
00:08:48.240 --> 00:08:51.540
you will be able to read and output data from a Store

173
00:08:51.540 --> 00:08:55.830
no matter if you're using Standalone Components or modules.

174
00:08:55.830 --> 00:08:58.230
And therefore, to see this in Action,

175
00:08:58.230 --> 00:09:01.080
I will actually run ng serve here

176
00:09:01.080 --> 00:09:02.880
to start up my development server

177
00:09:02.880 --> 00:09:05.010
and preview this application.

178
00:09:05.010 --> 00:09:06.480
And with that up and running,

179
00:09:06.480 --> 00:09:11.480
if I go to local host 4,200, I can see my counter there.

180
00:09:11.850 --> 00:09:13.650
Now these buttons don't work yet.

181
00:09:13.650 --> 00:09:17.220
We'll work on this soon, but I can see my counter.

182
00:09:17.220 --> 00:09:19.920
I also got no errors in the dev tools,

183
00:09:19.920 --> 00:09:22.380
and of course this will also be the case

184
00:09:22.380 --> 00:09:27.380
if I do this here for my Standalone Component application.

185
00:09:27.720 --> 00:09:31.500
If I run ng serve there, and I reload this page,

186
00:09:31.500 --> 00:09:34.233
that still works and I still get no errors.

