# 688. Introducing Actions & State Changing Reducers

> Duração: `8min`

Sem Recursos

WEBVTT

1
00:00:02.220 --> 00:00:03.660
<v Maximilian>So at this point we're able</v>

2
00:00:03.660 --> 00:00:05.970
to read data from the store,

3
00:00:05.970 --> 00:00:09.000
we're able to add data to the store,

4
00:00:09.000 --> 00:00:10.260
at least some initial data;

5
00:00:10.260 --> 00:00:12.870
and we can output that data on the screen.

6
00:00:12.870 --> 00:00:14.460
That's of course all great,

7
00:00:14.460 --> 00:00:16.200
but now of course we also wanna make sure

8
00:00:16.200 --> 00:00:20.610
that these buttons work and that this data can be changed.

9
00:00:20.610 --> 00:00:23.160
And for that we need actions

10
00:00:23.160 --> 00:00:25.050
because when using NgRx,

11
00:00:25.050 --> 00:00:28.140
you don't call reducers yourself.

12
00:00:28.140 --> 00:00:30.450
Instead, you dispatch actions,

13
00:00:30.450 --> 00:00:32.760
for example, from inside your Components

14
00:00:32.760 --> 00:00:36.480
so that NgRx can call those reducers for you,

15
00:00:36.480 --> 00:00:38.640
so that those reducers can then

16
00:00:38.640 --> 00:00:40.620
work on that latest state

17
00:00:40.620 --> 00:00:44.583
that is managed by NgRx and updated accordingly.

18
00:00:45.660 --> 00:00:48.180
Therefore, here, back in our application

19
00:00:48.180 --> 00:00:51.570
I will add a new file in this store folder.

20
00:00:51.570 --> 00:00:54.750
And I'll name it "counter dot actions dot TS."

21
00:00:54.750 --> 00:00:57.180
And of course, it's technically not required

22
00:00:57.180 --> 00:01:00.611
to split your code across files like this,

23
00:01:00.611 --> 00:01:03.480
but it is something you'll see a lot

24
00:01:03.480 --> 00:01:07.110
in all those applications that use NgRx;

25
00:01:07.110 --> 00:01:10.200
that you put your Reducer in a separate file,

26
00:01:10.200 --> 00:01:13.530
that you put your actions into a separate file,

27
00:01:13.530 --> 00:01:15.120
and that you put other things

28
00:01:15.120 --> 00:01:18.723
about which you will learn later into yet other files.

29
00:01:20.040 --> 00:01:22.590
So this actions TS file is all about

30
00:01:22.590 --> 00:01:25.470
defining the actions that can be

31
00:01:25.470 --> 00:01:28.110
dispatched in this application.

32
00:01:28.110 --> 00:01:29.790
And here in this application,

33
00:01:29.790 --> 00:01:31.380
we might want an action

34
00:01:31.380 --> 00:01:33.480
for incrementing the counter,

35
00:01:33.480 --> 00:01:35.493
for increasing it by one.

36
00:01:36.630 --> 00:01:39.240
Therefore, in this counteractions file,

37
00:01:39.240 --> 00:01:41.070
we can create a new constant

38
00:01:41.070 --> 00:01:44.400
because a action is again, a value in the end,

39
00:01:44.400 --> 00:01:48.000
an identifier of a certain action you could say.

40
00:01:48.000 --> 00:01:51.660
And I'll name my constant here, "Increment."

41
00:01:51.660 --> 00:01:54.240
And then such a action thing,

42
00:01:54.240 --> 00:01:56.940
such a action value is created

43
00:01:56.940 --> 00:01:59.280
by calling "Create Action,"

44
00:01:59.280 --> 00:02:02.610
which is a function provided by NgRx store;

45
00:02:02.610 --> 00:02:05.487
though just as with "Create Reducer,"

46
00:02:05.487 --> 00:02:09.570
there also is an alternative to calling create action,

47
00:02:09.570 --> 00:02:11.463
which I'll show you later.

48
00:02:12.480 --> 00:02:14.610
Now, create action is a function

49
00:02:14.610 --> 00:02:17.490
that needs one or two arguments,

50
00:02:17.490 --> 00:02:19.980
and at least one argument is always required.

51
00:02:19.980 --> 00:02:23.430
And that argument is the type of the action,

52
00:02:23.430 --> 00:02:26.100
the identifier of the action.

53
00:02:26.100 --> 00:02:29.010
And when using NgRx, this identifier,

54
00:02:29.010 --> 00:02:32.250
this type in the end is simply a string.

55
00:02:32.250 --> 00:02:33.990
For example, "Increment."

56
00:02:33.990 --> 00:02:35.580
Though the content of the string

57
00:02:35.580 --> 00:02:37.560
is totally up to you of course,

58
00:02:37.560 --> 00:02:40.470
it just must be some unique identifier

59
00:02:40.470 --> 00:02:43.350
so that in your Angular application

60
00:02:43.350 --> 00:02:47.220
you don't use the same identifier for different actions.

61
00:02:47.220 --> 00:02:49.380
That's something that should be avoided.

62
00:02:49.380 --> 00:02:52.380
And to avoid it, it's quite common to add

63
00:02:52.380 --> 00:02:55.350
kind of a prefix to this identifier;

64
00:02:55.350 --> 00:02:57.090
typically in square brackets,

65
00:02:57.090 --> 00:02:59.010
though, these are all just

66
00:02:59.010 --> 00:03:02.340
conventions and not technical requirements,

67
00:03:02.340 --> 00:03:05.670
but still it is a convention you might wanna follow.

68
00:03:05.670 --> 00:03:07.800
And the convention here is to put

69
00:03:07.800 --> 00:03:10.890
the name of the feature of the app

70
00:03:10.890 --> 00:03:12.570
to which this action belongs

71
00:03:12.570 --> 00:03:15.000
between those square brackets.

72
00:03:15.000 --> 00:03:17.220
So here, for example, "counter,"

73
00:03:17.220 --> 00:03:19.290
and if you instead had an action

74
00:03:19.290 --> 00:03:22.770
that belongs to the user authentication area,

75
00:03:22.770 --> 00:03:25.650
you could use "auth" instead.

76
00:03:25.650 --> 00:03:27.630
So that you have an identifier

77
00:03:27.630 --> 00:03:31.560
for the feature of the app to which the action belongs,

78
00:03:31.560 --> 00:03:32.880
and then after that,

79
00:03:32.880 --> 00:03:35.400
the actual action identifier,

80
00:03:35.400 --> 00:03:38.280
for example, "increment" here.

81
00:03:38.280 --> 00:03:41.430
So that's the overall action identifier.

82
00:03:41.430 --> 00:03:43.650
And with that action to find here

83
00:03:43.650 --> 00:03:47.430
you can export this action object,

84
00:03:47.430 --> 00:03:49.260
which it is under the hood,

85
00:03:49.260 --> 00:03:52.945
and then use it somewhere else in your application

86
00:03:52.945 --> 00:03:57.420
to execute different logic for different actions.

87
00:03:57.420 --> 00:03:59.160
So the question therefore is

88
00:03:59.160 --> 00:04:02.070
where you would use this action.

89
00:04:02.070 --> 00:04:05.460
And the answer is in the Reducer,

90
00:04:05.460 --> 00:04:06.960
because that's, in the end,

91
00:04:06.960 --> 00:04:08.850
where the state should be updated.

92
00:04:08.850 --> 00:04:11.100
So it's in this Reducer function

93
00:04:11.100 --> 00:04:13.863
where you want to listen to the action.

94
00:04:15.120 --> 00:04:17.490
Now, here I'll switch back to the approach

95
00:04:17.490 --> 00:04:19.830
that uses "Create Reducer."

96
00:04:19.830 --> 00:04:21.660
And when using this approach,

97
00:04:21.660 --> 00:04:23.280
listening to actions

98
00:04:23.280 --> 00:04:25.088
and executing different pieces

99
00:04:25.088 --> 00:04:26.962
of code for different actions

100
00:04:26.962 --> 00:04:29.370
is quite straightforward

101
00:04:29.370 --> 00:04:31.620
because you can pass a second argument

102
00:04:31.620 --> 00:04:34.917
to "Create Reducer" after the initial state.

103
00:04:34.917 --> 00:04:38.280
And that argument should be a value

104
00:04:38.280 --> 00:04:41.550
that is created with help of another function

105
00:04:41.550 --> 00:04:44.400
provided by NgRx store.

106
00:04:44.400 --> 00:04:48.510
And that other function is the "on" function.

107
00:04:48.510 --> 00:04:49.740
Though, as mentioned,

108
00:04:49.740 --> 00:04:51.840
in the next lecture I will show you

109
00:04:51.840 --> 00:04:53.640
what happens under the hood

110
00:04:53.640 --> 00:04:56.460
if you are not using Create Reducer.

111
00:04:56.460 --> 00:04:57.780
But here, when using it,

112
00:04:57.780 --> 00:04:59.820
you now use the "on" function

113
00:04:59.820 --> 00:05:04.820
and execute this as a second value for create Reducer.

114
00:05:05.070 --> 00:05:09.450
And this on function then itself needs some arguments.

115
00:05:09.450 --> 00:05:12.450
It needs two arguments to be precise.

116
00:05:12.450 --> 00:05:15.390
And the first argument is the action

117
00:05:15.390 --> 00:05:16.620
to which you wanna listen.

118
00:05:16.620 --> 00:05:20.220
So in this case, this increment action, which I created.

119
00:05:20.220 --> 00:05:22.800
And for this, you simply import

120
00:05:22.800 --> 00:05:25.860
this action from your actions file,

121
00:05:25.860 --> 00:05:29.037
and you then use it as a value for "on."

122
00:05:30.630 --> 00:05:31.500
But that's not all,

123
00:05:31.500 --> 00:05:35.490
you now also must pass a second value to "on."

124
00:05:35.490 --> 00:05:39.660
And that second value must be a function itself.

125
00:05:39.660 --> 00:05:43.620
A function that will be executed by NgRx

126
00:05:43.620 --> 00:05:46.140
whenever this action occurs,

127
00:05:46.140 --> 00:05:49.440
whenever this action is dispatched.

128
00:05:49.440 --> 00:05:54.060
And this function here, then, will be executed by NgRx,

129
00:05:54.060 --> 00:05:55.410
and this is the function

130
00:05:55.410 --> 00:05:58.323
that should contain the logic that updates the state.

131
00:05:59.160 --> 00:06:01.530
For this, this function will automatically

132
00:06:01.530 --> 00:06:04.200
receive the current state as an input,

133
00:06:04.200 --> 00:06:07.590
NgRx will pass the current state value

134
00:06:07.590 --> 00:06:10.110
for this Reducer into this function

135
00:06:10.110 --> 00:06:12.840
here whenever this action occurs,

136
00:06:12.840 --> 00:06:15.900
and then you should return the updated state.

137
00:06:15.900 --> 00:06:18.060
Though, what's really important here,

138
00:06:18.060 --> 00:06:20.340
really important to keep in mind,

139
00:06:20.340 --> 00:06:24.930
is that you should not directly change the existing state,

140
00:06:24.930 --> 00:06:28.530
but instead always produce a new value,

141
00:06:28.530 --> 00:06:30.240
which is especially important

142
00:06:30.240 --> 00:06:32.160
if the initial state is not a number,

143
00:06:32.160 --> 00:06:33.630
as is the case here,

144
00:06:33.630 --> 00:06:36.240
but if this would be an object or array.

145
00:06:36.240 --> 00:06:37.073
In that case,

146
00:06:37.073 --> 00:06:40.890
you should not directly mutate this array or object,

147
00:06:40.890 --> 00:06:44.190
but instead return a new array or object

148
00:06:44.190 --> 00:06:48.840
that can be based on the old state array or object.

149
00:06:48.840 --> 00:06:50.640
In this case here, it doesn't matter though.

150
00:06:50.640 --> 00:06:53.160
Instead we just wanna return a new number,

151
00:06:53.160 --> 00:06:55.560
which could either be hard coded like this,

152
00:06:55.560 --> 00:06:58.260
or typically a number that's based

153
00:06:58.260 --> 00:07:00.750
on the old number, the old state.

154
00:07:00.750 --> 00:07:03.063
So for example, here's state plus one.

155
00:07:04.140 --> 00:07:06.090
So with that dysfunction here,

156
00:07:06.090 --> 00:07:09.150
we'll return the old state plus one,

157
00:07:09.150 --> 00:07:10.740
and that will then automatically

158
00:07:10.740 --> 00:07:13.646
be used and stored by NgRx

159
00:07:13.646 --> 00:07:17.790
as the new state value for the slice of data

160
00:07:17.790 --> 00:07:20.670
that's managed by this Reducer.

161
00:07:20.670 --> 00:07:23.220
So the overall store can still consist

162
00:07:23.220 --> 00:07:24.930
of multiple pieces of data,

163
00:07:24.930 --> 00:07:28.140
but the piece of data that's managed by this Reducer

164
00:07:28.140 --> 00:07:30.810
will be updated whenever the increment action

165
00:07:30.810 --> 00:07:34.770
is dispatched with help of this function, here.

166
00:07:34.770 --> 00:07:36.330
So of course this was a lot of talking,

167
00:07:36.330 --> 00:07:37.590
but as you can see in the end,

168
00:07:37.590 --> 00:07:40.410
it's not a lot of code you have to add here.

169
00:07:40.410 --> 00:07:42.210
This is how you can listen to an action

170
00:07:42.210 --> 00:07:44.010
and then define the kind of code

171
00:07:44.010 --> 00:07:47.013
that should be executed when that action occurs.

