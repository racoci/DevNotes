# 697. Defining a First Effect

> Duração: `9min`

## Recursos
- 10-first-effect.zip
- 10-first-effect-standalone.zip


WEBVTT

1
00:00:02.160 --> 00:00:03.660
<v Maximilian>So here to store,</v>

2
00:00:03.660 --> 00:00:07.620
the counter value whenever it changes in localStorage,

3
00:00:07.620 --> 00:00:10.050
I'll add a new file in my store folder

4
00:00:10.050 --> 00:00:14.103
and I'll name it counter.effects.ts.

5
00:00:15.210 --> 00:00:16.950
Now like all these files,

6
00:00:16.950 --> 00:00:18.780
it's not technically required

7
00:00:18.780 --> 00:00:21.600
to have that file or to name it like this,

8
00:00:21.600 --> 00:00:23.520
but it is a good practice

9
00:00:23.520 --> 00:00:25.920
to have your actions in a separate file,

10
00:00:25.920 --> 00:00:27.990
your reducer in a separate file,

11
00:00:27.990 --> 00:00:29.940
your selectors in a separate file

12
00:00:29.940 --> 00:00:32.253
and your effects in a separate file.

13
00:00:33.240 --> 00:00:36.240
So here we have the counter.effects.ts file,

14
00:00:36.240 --> 00:00:40.350
and in there we can now create a new effect

15
00:00:40.350 --> 00:00:42.810
and store the logic that should be executed

16
00:00:42.810 --> 00:00:47.160
when a certain action occurs by creating a new class here.

17
00:00:47.160 --> 00:00:48.813
And I'll name it CounterEffects.

18
00:00:51.030 --> 00:00:54.630
Now this class can then contain multiple properties

19
00:00:54.630 --> 00:00:59.370
and every property in the end defines one pipeline,

20
00:00:59.370 --> 00:01:04.110
you could say, that should be executed for certain actions.

21
00:01:04.110 --> 00:01:08.160
So here we could start by adding a saveCount property

22
00:01:08.160 --> 00:01:09.960
to the CounterEffects class,

23
00:01:09.960 --> 00:01:12.930
and the value will be the code pipeline

24
00:01:12.930 --> 00:01:14.430
that should be executed

25
00:01:14.430 --> 00:01:17.700
whenever we want a saved account to local storage,

26
00:01:17.700 --> 00:01:21.183
so whenever we increment it or decrement it to counter.

27
00:01:22.290 --> 00:01:25.980
For this, we should use the createEffect function

28
00:01:25.980 --> 00:01:29.460
which must be imported from ngrx/effects,

29
00:01:29.460 --> 00:01:32.643
so which is coming from this new package we installed.

30
00:01:34.050 --> 00:01:37.740
CreateEffect creates such an effect value

31
00:01:37.740 --> 00:01:40.290
which should be stored for this property.

32
00:01:40.290 --> 00:01:43.200
And createEffect then actually wants

33
00:01:43.200 --> 00:01:45.360
a function as an input value.

34
00:01:45.360 --> 00:01:48.480
So to the createEffect function which we're executing,

35
00:01:48.480 --> 00:01:52.170
we're passing a new anonymous function here.

36
00:01:52.170 --> 00:01:56.490
And this function here then should return a value

37
00:01:56.490 --> 00:01:58.050
that is based on something

38
00:01:58.050 --> 00:02:00.810
we have to inject into this class.

39
00:02:00.810 --> 00:02:02.610
Therefore, before continuing here,

40
00:02:02.610 --> 00:02:04.410
we can add the constructor

41
00:02:04.410 --> 00:02:07.680
to use Angular's dependency injection mechanism

42
00:02:07.680 --> 00:02:11.040
to inject something into this CounterEffects class.

43
00:02:11.040 --> 00:02:13.770
And that something I want to inject in here

44
00:02:13.770 --> 00:02:18.770
is an actions property, which is of type Actions.

45
00:02:20.310 --> 00:02:22.410
So not Action but Actions,

46
00:02:22.410 --> 00:02:25.113
which is imported from ngrx/effects.

47
00:02:26.820 --> 00:02:30.570
Now actually, Actions here yields an observable,

48
00:02:30.570 --> 00:02:33.150
and therefore we can add a dollar sign here,

49
00:02:33.150 --> 00:02:35.130
which is again not technically required,

50
00:02:35.130 --> 00:02:37.560
but often used to make it clear

51
00:02:37.560 --> 00:02:40.440
that this value here holds an observable

52
00:02:40.440 --> 00:02:42.450
and this Actions type under the hood

53
00:02:42.450 --> 00:02:46.050
does indeed give us such an observable.

54
00:02:46.050 --> 00:02:49.170
So we must inject our actions here

55
00:02:49.170 --> 00:02:50.910
and now we can use this here

56
00:02:50.910 --> 00:02:52.650
inside of this anonymous function,

57
00:02:52.650 --> 00:02:54.300
and that's why we should also use

58
00:02:54.300 --> 00:02:56.070
an arrow function here to make sure

59
00:02:56.070 --> 00:02:58.770
that the this keyword when used here

60
00:02:58.770 --> 00:03:00.480
does refer to this class

61
00:03:00.480 --> 00:03:03.420
and has access to the injected actions

62
00:03:03.420 --> 00:03:04.710
because we now want to use

63
00:03:04.710 --> 00:03:08.040
the injected actions observable here

64
00:03:08.040 --> 00:03:11.193
to then call pipe on that observable,

65
00:03:12.090 --> 00:03:13.890
because that's how you can then

66
00:03:13.890 --> 00:03:18.240
combine different operations based on one observable

67
00:03:18.240 --> 00:03:19.860
when using RxJS.

68
00:03:19.860 --> 00:03:22.530
And of course, observables are provided

69
00:03:22.530 --> 00:03:24.570
by that RxJS library,

70
00:03:24.570 --> 00:03:26.940
so we have to use pipe here to then

71
00:03:26.940 --> 00:03:30.900
perform different actions for a this observable.

72
00:03:30.900 --> 00:03:32.940
And this might still be a bit abstract here,

73
00:03:32.940 --> 00:03:35.940
but it will make more sense in just a second.

74
00:03:35.940 --> 00:03:39.030
Because now the first action we wanna pipe here

75
00:03:39.030 --> 00:03:41.910
is the ofType action,

76
00:03:41.910 --> 00:03:45.780
which must also be imported from ngrx/effects.

77
00:03:45.780 --> 00:03:47.580
And ofType can only be used

78
00:03:47.580 --> 00:03:50.760
inside of such a pipe method call here.

79
00:03:50.760 --> 00:03:54.390
Now ofType now simply allows us to define

80
00:03:54.390 --> 00:03:58.470
for which actions we want to continue in this pipe here,

81
00:03:58.470 --> 00:04:01.200
and for which actions we want to execute some code.

82
00:04:01.200 --> 00:04:04.170
Because what this.actions here is observable,

83
00:04:04.170 --> 00:04:08.580
in the end does is it yields us a new value

84
00:04:08.580 --> 00:04:11.430
which we can handle whenever

85
00:04:11.430 --> 00:04:16.380
anywhere in our application an NgRx action is dispatched.

86
00:04:16.380 --> 00:04:19.680
That's what this injected actions object,

87
00:04:19.680 --> 00:04:22.260
this.actions observable gives us.

88
00:04:22.260 --> 00:04:26.490
It emits a new value whenever anywhere in the app

89
00:04:26.490 --> 00:04:28.710
an action is dispatched.

90
00:04:28.710 --> 00:04:30.900
And with this ofType operator,

91
00:04:30.900 --> 00:04:34.920
we can now basically filter those dispatched actions

92
00:04:34.920 --> 00:04:37.140
and decide for which actions

93
00:04:37.140 --> 00:04:39.960
we want to continue in this pipeline.

94
00:04:39.960 --> 00:04:42.300
For that, ofType then simply takes

95
00:04:42.300 --> 00:04:46.050
these action identifiers as inputs.

96
00:04:46.050 --> 00:04:48.720
For example, here, increment,

97
00:04:48.720 --> 00:04:53.250
we can import increment from counter.actions.

98
00:04:53.250 --> 00:04:55.770
And with that we would now only continue

99
00:04:55.770 --> 00:04:57.690
with the next step in this pipe,

100
00:04:57.690 --> 00:04:59.790
which we'll define in just a second

101
00:04:59.790 --> 00:05:04.140
if the dispatched action was the increment action.

102
00:05:04.140 --> 00:05:07.140
You can also pass more than one value to ofType

103
00:05:07.140 --> 00:05:09.210
to listen to multiple actions,

104
00:05:09.210 --> 00:05:12.600
for example, also to the decrement action here,

105
00:05:12.600 --> 00:05:14.103
which also must be imported.

106
00:05:15.090 --> 00:05:18.060
And you can by the way also not just pass these

107
00:05:18.060 --> 00:05:21.393
action functions that are created by using createAction.

108
00:05:22.230 --> 00:05:25.200
But instead, if you would be using this alternative syntax,

109
00:05:25.200 --> 00:05:28.770
you can also just pass the action identifier

110
00:05:28.770 --> 00:05:32.973
either like this or by using a globally available constant.

111
00:05:34.200 --> 00:05:36.690
Now here I'll go back to using increment

112
00:05:36.690 --> 00:05:38.700
and decrement like this though.

113
00:05:38.700 --> 00:05:40.800
But of course, that's not all I want to do here.

114
00:05:40.800 --> 00:05:43.860
Instead, filtering for certain actions is nice,

115
00:05:43.860 --> 00:05:47.040
but we now also wanna define what should happen

116
00:05:47.040 --> 00:05:49.470
when these actions occur.

117
00:05:49.470 --> 00:05:52.320
And here you now got two main options.

118
00:05:52.320 --> 00:05:54.930
You can either execute some code,

119
00:05:54.930 --> 00:05:58.560
which then should lead to another action being dispatched,

120
00:05:58.560 --> 00:06:01.860
which then should maybe trigger some reducer function.

121
00:06:01.860 --> 00:06:03.930
That could make sense if you're, for example,

122
00:06:03.930 --> 00:06:06.570
sending a get request to some backend

123
00:06:06.570 --> 00:06:08.580
and you're fetching some data from there

124
00:06:08.580 --> 00:06:11.130
which you then want to use once it's available

125
00:06:11.130 --> 00:06:14.370
to update some data with help of a reducer

126
00:06:14.370 --> 00:06:16.863
and I'll come back to this use case later.

127
00:06:17.910 --> 00:06:20.970
Alternatively, you could also have a pipeline

128
00:06:20.970 --> 00:06:23.280
that should perform a side effect

129
00:06:23.280 --> 00:06:26.100
but not dispatch any other action thereafter.

130
00:06:26.100 --> 00:06:28.170
So which shouldn't in the end not trigger

131
00:06:28.170 --> 00:06:31.530
any other side effects or lead to any state changes

132
00:06:31.530 --> 00:06:33.600
by reducer functions.

133
00:06:33.600 --> 00:06:36.240
And that's what I want to do here for this use case

134
00:06:36.240 --> 00:06:39.630
where I want to save some count to the local storage.

135
00:06:39.630 --> 00:06:43.650
Here we can use the tap operator offered by RxJS

136
00:06:43.650 --> 00:06:47.610
and therefore you must import it from RxJS.

137
00:06:47.610 --> 00:06:50.850
And the tap operator allows you to register a function

138
00:06:50.850 --> 00:06:54.360
that will be executed that does then not yield

139
00:06:54.360 --> 00:06:56.490
a new observable once it's done

140
00:06:56.490 --> 00:06:59.100
or that does not yield a new value

141
00:06:59.100 --> 00:07:00.933
once it's done to be precise.

142
00:07:01.860 --> 00:07:04.680
Here inside of tap, we will get the action

143
00:07:04.680 --> 00:07:06.603
that was dispatched as an input,

144
00:07:07.950 --> 00:07:09.390
and then here we could, for example,

145
00:07:09.390 --> 00:07:11.730
console.log that action

146
00:07:11.730 --> 00:07:14.370
and we could also reach out to localStorage

147
00:07:14.370 --> 00:07:17.940
and for example, set a new item here

148
00:07:17.940 --> 00:07:19.950
and the item could be called count,

149
00:07:19.950 --> 00:07:23.100
and the value could be the count which you wanna store,

150
00:07:23.100 --> 00:07:25.230
for example, one or two or three,

151
00:07:25.230 --> 00:07:26.520
as a string though.

152
00:07:26.520 --> 00:07:28.593
Storing numbers like this is not allowed.

153
00:07:30.030 --> 00:07:32.370
So here we could store the action.value,

154
00:07:32.370 --> 00:07:35.310
though that will actually not be the current count,

155
00:07:35.310 --> 00:07:38.100
but just the value by which the count changes.

156
00:07:38.100 --> 00:07:40.500
Nonetheless, that's what I'll use for now.

157
00:07:40.500 --> 00:07:42.660
Here we should just call toString then

158
00:07:42.660 --> 00:07:44.580
to make sure that this is a string,

159
00:07:44.580 --> 00:07:47.433
because setItem wants a string value here.

160
00:07:48.870 --> 00:07:51.900
And with that we would have this action to find.

161
00:07:51.900 --> 00:07:55.260
However, if you have an action pipeline like this,

162
00:07:55.260 --> 00:07:59.070
which does in the end not dispatch a new action,

163
00:07:59.070 --> 00:08:03.510
you should also add a second argument to createEffect

164
00:08:03.510 --> 00:08:06.630
after this first argument, which is this function.

165
00:08:06.630 --> 00:08:09.870
And this second argument is a configuration object

166
00:08:09.870 --> 00:08:14.100
where you should set the dispatch property to false,

167
00:08:14.100 --> 00:08:16.200
making it clear that this effect

168
00:08:16.200 --> 00:08:19.803
does not dispatch a new action once it's done.

169
00:08:20.760 --> 00:08:22.200
And you have to set this,

170
00:08:22.200 --> 00:08:24.090
because the default indeed is

171
00:08:24.090 --> 00:08:28.230
that effects do dispatch new actions once they are done.

172
00:08:28.230 --> 00:08:31.263
And again, you will see this in a couple of minutes.

173
00:08:32.490 --> 00:08:34.590
But here I don't wanna dispatch anything,

174
00:08:34.590 --> 00:08:38.043
and with that, we defined our first side effect.

