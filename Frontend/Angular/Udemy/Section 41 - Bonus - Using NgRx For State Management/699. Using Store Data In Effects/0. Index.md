# 699. Using Store Data In Effects

> Duração: `3min`

Sem Recursos

WEBVTT

1
00:00:02.040 --> 00:00:04.440
<v Maximilian>So now that we got our first effect,</v>

2
00:00:04.440 --> 00:00:05.700
let's improve it

3
00:00:05.700 --> 00:00:08.130
by making sure that we don't store the value

4
00:00:08.130 --> 00:00:11.490
by which the counter changed in local storage,

5
00:00:11.490 --> 00:00:13.650
but instead the latest counter value

6
00:00:13.650 --> 00:00:16.620
that's stored in our NgRx store.

7
00:00:16.620 --> 00:00:19.440
And that's of course a pretty common requirement

8
00:00:19.440 --> 00:00:20.730
that you want to get access

9
00:00:20.730 --> 00:00:23.520
to data stored in the store instead

10
00:00:23.520 --> 00:00:26.643
of just the value that's attached to an action.

11
00:00:27.690 --> 00:00:29.490
And you can easily get hold

12
00:00:29.490 --> 00:00:33.930
of the latest value stored in the store by using the special

13
00:00:33.930 --> 00:00:38.610
with latest from operator offered by rxjs.

14
00:00:39.840 --> 00:00:42.690
So this must be imported from rxjs

15
00:00:42.690 --> 00:00:46.230
and with latest from then allows you

16
00:00:46.230 --> 00:00:51.090
to pass some value to this operator,

17
00:00:51.090 --> 00:00:54.720
which is then available in the next operator thereafter.

18
00:00:54.720 --> 00:00:57.780
For that here in this effects clause,

19
00:00:57.780 --> 00:01:00.810
we can inject our store,

20
00:01:00.810 --> 00:01:05.810
so our NgRx store by importing store from NgRx store

21
00:01:07.470 --> 00:01:08.550
and by using that

22
00:01:08.550 --> 00:01:12.720
as a type assignment here for this store property.

23
00:01:12.720 --> 00:01:15.420
And then here in with latest from,

24
00:01:15.420 --> 00:01:18.930
we can use this store select

25
00:01:18.930 --> 00:01:22.533
and select our counter, for example.

26
00:01:23.400 --> 00:01:27.300
And here we then might want to add some type annotations

27
00:01:27.300 --> 00:01:30.090
to get better TypeScript support

28
00:01:30.090 --> 00:01:33.600
by defining the shape of our global store here,

29
00:01:33.600 --> 00:01:35.190
where we have this counter key

30
00:01:35.190 --> 00:01:39.900
that stores the counter store as a number.

31
00:01:39.900 --> 00:01:42.720
And of course we could also use our selectors here,

32
00:01:42.720 --> 00:01:45.900
our select count selector, for example,

33
00:01:45.900 --> 00:01:49.113
which is imported from counter selectors from that file.

34
00:01:50.663 --> 00:01:53.070
With this operator added here

35
00:01:53.070 --> 00:01:55.590
in the next operator thereafter,

36
00:01:55.590 --> 00:01:58.830
we get a different kind of value as an input.

37
00:01:58.830 --> 00:02:01.560
Instead of just getting the action here,

38
00:02:01.560 --> 00:02:03.510
we're now actually getting

39
00:02:03.510 --> 00:02:06.540
an array of different pieces of data.

40
00:02:06.540 --> 00:02:09.930
To be precise, an array with two elements.

41
00:02:09.930 --> 00:02:12.960
And therefore we can also use array destructuring here

42
00:02:12.960 --> 00:02:17.220
to pull these two elements out of the array.

43
00:02:17.220 --> 00:02:21.480
The first element will be our action just as before,

44
00:02:21.480 --> 00:02:24.270
but the second element will be that data,

45
00:02:24.270 --> 00:02:27.423
which we kind of merged into this array.

46
00:02:28.320 --> 00:02:32.550
So here our counter, in this case a number

47
00:02:32.550 --> 00:02:34.710
as you can also see here.

48
00:02:34.710 --> 00:02:36.150
And therefore, of course, now here

49
00:02:36.150 --> 00:02:38.160
we can still log our action,

50
00:02:38.160 --> 00:02:42.810
but we can now also store our counter in local storage.

51
00:02:42.810 --> 00:02:45.423
We just need to convert it to a string though.

52
00:02:46.860 --> 00:02:49.200
And that's how easy it is to get hold

53
00:02:49.200 --> 00:02:52.530
of a value stored in our NgRx store

54
00:02:52.530 --> 00:02:54.870
and how we can then use this value

55
00:02:54.870 --> 00:02:57.093
in our effect pipeline here.

56
00:02:57.930 --> 00:02:59.730
And with this change in place,

57
00:02:59.730 --> 00:03:02.760
if we save everything and serve this,

58
00:03:02.760 --> 00:03:05.970
you will see that if I now go to application

59
00:03:05.970 --> 00:03:09.450
and I clear this count value here

60
00:03:09.450 --> 00:03:12.300
now you see that as I change the counter,

61
00:03:12.300 --> 00:03:16.110
this value is also reflected here on the right.

62
00:03:16.110 --> 00:03:18.270
So now we're not just storing the value

63
00:03:18.270 --> 00:03:20.280
by which the counter gets changed,

64
00:03:20.280 --> 00:03:22.713
but instead the latest counter value.

