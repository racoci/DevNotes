# 692. An Alternative Way Of Defining Actions

> Duração: `10min`

## Recursos
- 07-alternative-syntax.zip
- 07-alternative-syntax-standalone.zip

WEBVTT

1
00:00:02.520 --> 00:00:05.700
<v Maximilian>Instead of defining the action like this,</v>

2
00:00:05.700 --> 00:00:08.220
you could define your own function,

3
00:00:08.220 --> 00:00:11.640
which when called generates an Action object.

4
00:00:11.640 --> 00:00:13.980
Because again, I can't emphasize this enough,

5
00:00:13.980 --> 00:00:17.670
keep in mind that this thing returned by createAction,

6
00:00:17.670 --> 00:00:19.590
which is stored in increment here,

7
00:00:19.590 --> 00:00:21.210
is just a function in the end.

8
00:00:21.210 --> 00:00:23.400
A function that returns an object

9
00:00:23.400 --> 00:00:26.070
with a type and a value property.

10
00:00:26.070 --> 00:00:28.803
So in the end, that is what you want to rebuild here.

11
00:00:29.880 --> 00:00:33.210
And one very common way of rebuilding a function

12
00:00:33.210 --> 00:00:36.480
that generates objects in JavaScript is,

13
00:00:36.480 --> 00:00:38.850
of course, to use a class.

14
00:00:38.850 --> 00:00:41.040
So you could export a class here,

15
00:00:41.040 --> 00:00:42.993
which maybe is called IncrementAction,

16
00:00:44.580 --> 00:00:46.800
which should actually then implement

17
00:00:46.800 --> 00:00:50.070
an interface provided by NgRx,

18
00:00:50.070 --> 00:00:55.070
the Action interface, which is imported from ngrx/store.

19
00:00:56.370 --> 00:01:00.510
And this interface then simply forces you

20
00:01:00.510 --> 00:01:03.510
to implement a type property,

21
00:01:03.510 --> 00:01:04.863
which should be a string.

22
00:01:06.000 --> 00:01:08.430
This typically should be a read-only type.

23
00:01:08.430 --> 00:01:11.250
And that's just an extra TypeScript annotation,

24
00:01:11.250 --> 00:01:14.040
which makes it very clear that this value

25
00:01:14.040 --> 00:01:17.760
of this property should not be overwritten.

26
00:01:17.760 --> 00:01:19.620
And for one specific action,

27
00:01:19.620 --> 00:01:21.540
in this case, the IncrementAction,

28
00:01:21.540 --> 00:01:24.750
we typically also hard code the type into this action.

29
00:01:24.750 --> 00:01:27.573
For example, here, Counter Increment.

30
00:01:29.580 --> 00:01:30.720
Then, to make sure

31
00:01:30.720 --> 00:01:33.780
that this action can also carry some data,

32
00:01:33.780 --> 00:01:37.560
you can simply add a constructor function here

33
00:01:37.560 --> 00:01:40.410
to make it easy to add data to this action

34
00:01:40.410 --> 00:01:41.583
when it's dispatched.

35
00:01:42.480 --> 00:01:45.720
And here, you can then accept the payload,

36
00:01:45.720 --> 00:01:49.050
let's say, that should be attached to this action

37
00:01:49.050 --> 00:01:51.180
and to find a type of that payload.

38
00:01:51.180 --> 00:01:52.830
And that could be an object

39
00:01:52.830 --> 00:01:55.860
with a property called name, for example,

40
00:01:55.860 --> 00:01:57.870
or it could just be a number,

41
00:01:57.870 --> 00:02:00.180
if you know that this action should simply include

42
00:02:00.180 --> 00:02:02.280
a number as a value.

43
00:02:02.280 --> 00:02:04.020
Or, as I had it here,

44
00:02:04.020 --> 00:02:06.900
we could make sure that the payload is actually an object

45
00:02:06.900 --> 00:02:10.620
that has a value property which then is of type number.

46
00:02:10.620 --> 00:02:13.290
Though, here, I'll choose a slightly different approach

47
00:02:13.290 --> 00:02:16.590
and set the payload to a number like this.

48
00:02:16.590 --> 00:02:18.240
And instead of naming it payload,

49
00:02:18.240 --> 00:02:21.330
I'll name it value and add public in front of it

50
00:02:21.330 --> 00:02:23.280
to use this TypeScript shortcut

51
00:02:23.280 --> 00:02:27.000
where this will now become a property of the objects

52
00:02:27.000 --> 00:02:29.760
that are created based on this class

53
00:02:29.760 --> 00:02:33.090
so that when we instantiate this IncrementAction class,

54
00:02:33.090 --> 00:02:36.060
we'll always get an object that has a type property,

55
00:02:36.060 --> 00:02:37.320
which is of this type,

56
00:02:37.320 --> 00:02:40.260
and that has a value property, which is a number.

57
00:02:40.260 --> 00:02:43.230
And that therefore then gives us an Action object

58
00:02:43.230 --> 00:02:47.610
that has exactly the same shape as this Action object has,

59
00:02:47.610 --> 00:02:50.163
once increment is called like a function.

60
00:02:51.210 --> 00:02:54.030
And with that, we have such a class here

61
00:02:54.030 --> 00:02:56.610
that gives us such an Action object.

62
00:02:56.610 --> 00:02:58.770
And inside of counter-controls.component,

63
00:02:58.770 --> 00:03:03.180
we could now simply instantiate this class here,

64
00:03:03.180 --> 00:03:04.770
like this, IncrementAction,

65
00:03:04.770 --> 00:03:07.113
and then pass the value to it like this.

66
00:03:08.460 --> 00:03:10.230
And that's, of course, just one way

67
00:03:10.230 --> 00:03:12.690
of implementing our own action.

68
00:03:12.690 --> 00:03:15.720
You could use any approach that in the end ensures

69
00:03:15.720 --> 00:03:19.290
that you get an Action object that has a type property,

70
00:03:19.290 --> 00:03:21.990
and in this case, also a value property,

71
00:03:21.990 --> 00:03:23.460
though, as I mentioned before,

72
00:03:23.460 --> 00:03:24.840
it is totally up to you

73
00:03:24.840 --> 00:03:26.910
which kind and shape of data you want

74
00:03:26.910 --> 00:03:28.383
to attach to your action.

75
00:03:29.670 --> 00:03:30.930
Here, we can do it like this

76
00:03:30.930 --> 00:03:33.390
and get rid of this increment import.

77
00:03:33.390 --> 00:03:36.270
And now as a last step, I also wanna make sure

78
00:03:36.270 --> 00:03:38.730
that I improve the typing of my reducer.

79
00:03:38.730 --> 00:03:40.530
Of course, this step is optional,

80
00:03:40.530 --> 00:03:42.570
but I still want to go through it.

81
00:03:42.570 --> 00:03:44.490
Therefore, I'll comment out this import,

82
00:03:44.490 --> 00:03:46.980
which at the moment doesn't work anymore.

83
00:03:46.980 --> 00:03:48.840
And in this reducer,

84
00:03:48.840 --> 00:03:51.810
I wanna replace any here with a type

85
00:03:51.810 --> 00:03:54.300
that actually includes all the actions

86
00:03:54.300 --> 00:03:56.133
this reducer should handle.

87
00:03:57.000 --> 00:03:59.820
And for that, we can use a little TypeScript trick.

88
00:03:59.820 --> 00:04:02.160
We can export a custom type here

89
00:04:02.160 --> 00:04:04.350
by using the type keyword,

90
00:04:04.350 --> 00:04:06.663
and then name our actions here CounterActions.

91
00:04:08.040 --> 00:04:09.900
This name is up to you, though.

92
00:04:09.900 --> 00:04:13.140
And set this equal to all the actions

93
00:04:13.140 --> 00:04:16.650
that should be related to this counter part

94
00:04:16.650 --> 00:04:18.090
of this application.

95
00:04:18.090 --> 00:04:20.730
In this case, that's only the IncrementAction.

96
00:04:20.730 --> 00:04:22.170
But if we had another action,

97
00:04:22.170 --> 00:04:25.680
we could add it separated by a pipe symbol.

98
00:04:25.680 --> 00:04:27.000
Like this, for example.

99
00:04:27.000 --> 00:04:28.620
We don't have this action yet,

100
00:04:28.620 --> 00:04:31.980
but that's how we could group multiple actions together

101
00:04:31.980 --> 00:04:33.600
into one type.

102
00:04:33.600 --> 00:04:35.280
Though, here, I'll get rid of this action,

103
00:04:35.280 --> 00:04:36.280
which we don't have.

104
00:04:37.230 --> 00:04:39.240
And now we can use CounterActions,

105
00:04:39.240 --> 00:04:41.130
which is a group of all the actions

106
00:04:41.130 --> 00:04:43.410
that are related to the counter,

107
00:04:43.410 --> 00:04:45.840
as a type instead of any.

108
00:04:45.840 --> 00:04:47.963
Here, we can use CounterActions.

109
00:04:49.260 --> 00:04:53.463
Of course, we also must import this from the actions file.

110
00:04:54.420 --> 00:04:59.313
And now here, we can indeed use any type that we have.

111
00:05:00.540 --> 00:05:01.620
And now with that,

112
00:05:01.620 --> 00:05:05.820
you will see that if I try to check for a certain type,

113
00:05:05.820 --> 00:05:08.700
TypeScript indeed only suggests me types

114
00:05:08.700 --> 00:05:13.020
that are supported by the CounterActions I defined,

115
00:05:13.020 --> 00:05:14.910
and it therefore reduces the danger

116
00:05:14.910 --> 00:05:16.413
of having a typo in here.

117
00:05:17.340 --> 00:05:21.480
Alternatively, we could even take this one step further,

118
00:05:21.480 --> 00:05:24.600
and we could add another constant here

119
00:05:24.600 --> 00:05:26.820
in our counter.actions file

120
00:05:26.820 --> 00:05:29.070
and maybe name it INCREMENT

121
00:05:29.070 --> 00:05:32.160
and store our identifier in this constant

122
00:05:32.160 --> 00:05:34.890
so that we have only one place where we store this,

123
00:05:34.890 --> 00:05:36.750
and we then export this constant.

124
00:05:36.750 --> 00:05:39.790
And we then simply use this constant here

125
00:05:41.280 --> 00:05:46.280
and also here by importing it and using it.

126
00:05:47.790 --> 00:05:49.710
And now we have only one place

127
00:05:49.710 --> 00:05:51.450
where we define this identifier.

128
00:05:51.450 --> 00:05:54.390
And then in all the places where we use the identifier,

129
00:05:54.390 --> 00:05:55.950
we just use this constant,

130
00:05:55.950 --> 00:06:00.270
hence further reducing the danger of having a typo in there.

131
00:06:00.270 --> 00:06:02.730
And all this is totally optional,

132
00:06:02.730 --> 00:06:05.610
and of course, it is some extra work, but in the end,

133
00:06:05.610 --> 00:06:07.230
it's what happens under the hood

134
00:06:07.230 --> 00:06:09.240
when you're using createAction,

135
00:06:09.240 --> 00:06:11.490
and it is an approach you will also see

136
00:06:11.490 --> 00:06:14.370
in some Angular NgRx projects.

137
00:06:14.370 --> 00:06:15.600
And therefore, this is

138
00:06:15.600 --> 00:06:18.480
also an approach you should be aware of.

139
00:06:18.480 --> 00:06:21.060
Now, one additional thing you should do,

140
00:06:21.060 --> 00:06:22.950
at least if you have a project

141
00:06:22.950 --> 00:06:27.660
where in your tsconfig file strict is set to true,

142
00:06:27.660 --> 00:06:31.080
you should go to your counterReducer,

143
00:06:31.080 --> 00:06:32.490
when using this approach

144
00:06:32.490 --> 00:06:35.490
of defining action classes yourself,

145
00:06:35.490 --> 00:06:38.160
and add the pipe symbol here

146
00:06:38.160 --> 00:06:41.490
for the type annotation of this action parameter.

147
00:06:41.490 --> 00:06:43.980
And also add Action here,

148
00:06:43.980 --> 00:06:47.850
imported from NgRx as a type.

149
00:06:47.850 --> 00:06:50.460
So import Action from ngrx/store,

150
00:06:50.460 --> 00:06:52.860
and also add it as a type in combination

151
00:06:52.860 --> 00:06:54.720
with CounterActions here.

152
00:06:54.720 --> 00:06:57.570
I'm doing this because, as I mentioned before,

153
00:06:57.570 --> 00:07:00.090
and that's really important to understand,

154
00:07:00.090 --> 00:07:03.330
this reducer will get executed by NgRx

155
00:07:03.330 --> 00:07:05.640
whenever an action is dispatched.

156
00:07:05.640 --> 00:07:08.940
Not just when CounterActions are dispatched,

157
00:07:08.940 --> 00:07:12.690
but for any action that might be dispatched anywhere

158
00:07:12.690 --> 00:07:14.490
in your application.

159
00:07:14.490 --> 00:07:17.130
If you had user authentication in this app

160
00:07:17.130 --> 00:07:20.370
and you would be dispatching actions related to that,

161
00:07:20.370 --> 00:07:23.670
this reducer would also be triggered by NgRx,

162
00:07:23.670 --> 00:07:26.730
even if it doesn't care about those actions.

163
00:07:26.730 --> 00:07:31.170
Therefore, the actual type of action is that it's any action

164
00:07:31.170 --> 00:07:34.770
that implements NgRx's Action interface.

165
00:07:34.770 --> 00:07:38.760
It's not just CounterActions that trigger this reducer.

166
00:07:38.760 --> 00:07:41.850
Of course, here, I only care about CounterActions,

167
00:07:41.850 --> 00:07:43.620
but nonetheless, in theory,

168
00:07:43.620 --> 00:07:46.470
Action could be any kind of object here.

169
00:07:46.470 --> 00:07:48.750
Now, with this change implemented,

170
00:07:48.750 --> 00:07:51.390
TypeScript now actually complains here

171
00:07:51.390 --> 00:07:54.810
that this value property doesn't necessarily exist

172
00:07:54.810 --> 00:07:57.030
on action, though we, of course,

173
00:07:57.030 --> 00:07:59.040
know that it will because here,

174
00:07:59.040 --> 00:08:00.840
when we're in this if branch,

175
00:08:00.840 --> 00:08:03.480
we know that the action type is INCREMENT.

176
00:08:03.480 --> 00:08:05.910
And we know that if that's the case,

177
00:08:05.910 --> 00:08:09.750
we'll have an action that does have a value property.

178
00:08:09.750 --> 00:08:12.750
And therefore, here, we could convince TypeScript

179
00:08:12.750 --> 00:08:15.150
that we are right here by, for example,

180
00:08:15.150 --> 00:08:17.100
wrapping action in parentheses

181
00:08:17.100 --> 00:08:19.230
and adding some type casting here

182
00:08:19.230 --> 00:08:21.813
with TypeScript's as keyword.

183
00:08:22.650 --> 00:08:26.700
And then here we could set this type to IncrementAction,

184
00:08:26.700 --> 00:08:30.033
which also must be imported from the counter.actions file.

185
00:08:31.980 --> 00:08:34.470
With that, we're telling TypeScript that we know

186
00:08:34.470 --> 00:08:36.360
that in here, in this if branch,

187
00:08:36.360 --> 00:08:37.980
the action which we're handling

188
00:08:37.980 --> 00:08:39.990
will be the IncrementAction.

189
00:08:39.990 --> 00:08:41.940
And we do know that this will be the case

190
00:08:41.940 --> 00:08:43.803
because the type is increment.

191
00:08:44.700 --> 00:08:47.460
So that's how we could build this reducer ourself

192
00:08:47.460 --> 00:08:50.100
and how we could build this action ourself.

193
00:08:50.100 --> 00:08:51.510
And as mentioned, of course,

194
00:08:51.510 --> 00:08:53.370
this is just one option.

195
00:08:53.370 --> 00:08:57.570
Obviously, using createAction and createReducer is shorter,

196
00:08:57.570 --> 00:08:59.580
but in my opinion, it's still important

197
00:08:59.580 --> 00:09:02.250
to understand what's happening under the hood.

198
00:09:02.250 --> 00:09:03.930
And as mentioned before,

199
00:09:03.930 --> 00:09:06.540
you are now also able to work on projects

200
00:09:06.540 --> 00:09:10.443
that do use this alternative NgRx syntax.

201
00:09:11.400 --> 00:09:14.550
With that, though, I'll reverse all of that

202
00:09:14.550 --> 00:09:17.730
and comment out the alternative code

203
00:09:17.730 --> 00:09:19.173
and go back to createAction.

204
00:09:20.100 --> 00:09:23.020
And also in the reducer, I'll comment out this

205
00:09:24.150 --> 00:09:26.370
and go back to this reducer.

206
00:09:26.370 --> 00:09:28.620
Comment out these imports, and instead,

207
00:09:28.620 --> 00:09:30.873
comment in this import here.

208
00:09:32.280 --> 00:09:34.890
And in the counter-control.component,

209
00:09:34.890 --> 00:09:37.110
I'll comment out this import,

210
00:09:37.110 --> 00:09:41.880
and instead, again, here, call increment,

211
00:09:41.880 --> 00:09:45.300
which is imported from the counter.actions file,

212
00:09:45.300 --> 00:09:46.620
execute it as a function,

213
00:09:46.620 --> 00:09:50.013
and pass my object where I set the value to it.

214
00:09:52.800 --> 00:09:54.450
So that's the code we had before,

215
00:09:54.450 --> 00:09:56.760
before I showed you this alternative solution,

216
00:09:56.760 --> 00:09:57.900
but as mentioned,

217
00:09:57.900 --> 00:10:00.723
it's worth knowing about this alternative approach.

