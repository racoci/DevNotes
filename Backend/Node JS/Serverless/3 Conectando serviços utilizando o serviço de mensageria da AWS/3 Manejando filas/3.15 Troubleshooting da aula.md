# 3.15 Para saber mais: Troubleshooting da aula

## Erros no deploy do tipo “fila não encontrada” ou “função já existe”

Assim como pode ocorrer com funções, filas definidas e criadas pelo Serverless que forem eventualmente deletadas usando o console da AWS podem gerar erros de deploy.

O “workaround” é o mesmo: fazer um novo deploy comentando as partes problemáticas no serverless.yml, e após o término do deploy com sucesso, descomentar as linhas e fazer um segundo deploy.

## Erros no deploy do tipo `does not contain mandatory attribute`

Normalmente são erros de indentação no arquivo `serverless.yml`. Verifique novamente se o aninhamento das propriedades (usando tab) está correto; caso necessário você pode consultar o repositório da aula.

## Erro no deploy: timeout de fila menor que o da função

Caso o terminal mostre um erro do tipo `Queue visibility timeout: XX seconds is less than Function timeout: XX seconds (Service: AWSLambda; Status Code: 400; Error Code: InvalidParameterValueException; Request ID: ****)`, verifique se os valores de timeout na função lambda e na fila estão corretamente configurados - o valor da fila sempre deve ser maior que o da função.

## Erro no deploy: `Redrive policy does not contain mandatory attribute: maxReceiveCount`

Ao usarmos a propriedade `RedrivePolicy` para ligar uma DLQ a uma fila principal, é obrigatório declararmos a quantidade de tentativas de entrega que serão feitas ao consumer antes de redirecionar a mensagem para a DLQ.

```yml
 Resources:
   FilaCadastro:
     Type: AWS::SQS::Queue
     Properties:
       QueueName: cadastro.fifo
       FifoQueue: true
       SqsManagedSseEnabled: false
       RedrivePolicy:
         deadLetterTargetArn:
           Fn::GetAtt:
             - DlqCadastro
             - Arn
         maxReceiveCount: 5
       VisibilityTimeout: 10
```