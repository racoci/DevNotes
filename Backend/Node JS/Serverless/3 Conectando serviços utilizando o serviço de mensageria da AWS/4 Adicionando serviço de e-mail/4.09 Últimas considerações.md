Analisando o diagrama podemos perceber que já temos todas as implementações que precisávamos fazer.

Criamos um **serviço** para cada **parte do fluxo**, sendo:

1. Para extrair o CSV;
2. Para se comunicar com a AWS e gerar a URL pré-assinada;
3. Para realizar a chamada API;
4. Para envio de e-mail.

Para **conectar** esses serviços e deixá-los independentes utilizamos a **mensageria**.

Isso significa que quem sabe de onde vem e para onde vão os dados são apenas a mensageria, os producers e consumers, que pegam essas filas e enviam para os serviços.

Para finalizar o curso faremos algumas análises sobre como o projeto foi pensado e montado e tiraremos algumas conclusões.

# Analisando o projeto

Os cadastros que vem do front a partir do preenchimento de nome e e-mail não estão passando pelo serviço de "chamada API" e sim indo direto para a "API REST cadastro". Os únicos cadastros que fazem esse caminho são os em lote, em CSV.

> Lembrando que a "API REST cadastro" não está no serverless e sim em uma máquina virtual. Discutimos anteriormente que, no contexto do nosso produto, fazia mais sentido que ficasse separado, em uma VM, já que os cadastros unitários são mais volumosos.
> 
> Especificamente considerando nosso produto, os cadastros em lote não ocorrem com tanta frequência, por isso faz mais sentido que sejam encaminhados para o serviço Serverless.

Continuaremos analisando a interação entre a função "chamada API" e as chamadas "FRONT cadastro" e "API REST cadastro".

Suponhamos que um influencer divulgou um desconto e muitas pessoas entraram no site para fazer o cadastro. Ao mesmo tempo, recebemos no B2B 10mil novos colaboradores, que precisam ser cadastrados em lote.

Precisamos considerar que, para ter maior disponibilidade, a API não está no lambda. Além disso, os cadastros únicos, de usuários B2C, são **preferencia** para a empresa.

Isso porque o cadastro individual do usuário precisa ser mais rápido, afinal, a pessoa quer acessar a plataforma no mesmo momento.

Enquanto isso o público B2B, por ser um público maior, já é esperado que os e-mails de confirmação demorem um pouco mais. Então, para nosso produto os cadastros individuais possuem preferência na fila de cadastro.

Como a “API REST cadastro" possui uma **capacidade limitada** no processo de receber e processar requisições simultâneas essa priorização é essencial para que o serviço não seja derrubado.

### Solucionando esse problema

Uma forma de solucionar esse problema seria utilizando as filas do curso com a API Gateway, que proporciona pontos de entrada entre APIs e serviços. Assim, seria possível **conectar** o front ao restante da aplicação que está no Serverless.

Nesse caso, ao invés de enviar uma requisição direto para API o front enviaria o cadastro por meio da "API gateway" para outra fila de cadastro. Essa fila acessaria o "MS cadastro", o substituto do "API REST", que faria o restante do trabalho.

Já as chamadas em lote, o serviço de “chamada API” que está no Serverless, acessaria a mesma fila. Assim, teríamos outra fila que recebe mensagem da "API gateway" e da "chamada de API" que se conectaria ao "MS cadastro".

Dessa forma, se houver gargalos, um consumer da nova fila de cadastro ficaria responsável por consumir e **configurar a quantidade de acessos** simultâneos na API.

Porém, isso não resolveria o problema todo. Ainda precisaríamos priorizar as mensagens do front. Para resolver isso poderíamos utilizar **outros serviços de mensageria**, como o RabbitMQ que trabalha com hierarquia de filas.

Outra opção seria ter **dois serviços em paralelo**, um para receber mensagens somente de uma fila do front e para o CSV e front.

Assim o front teria prioridade na quantidade de chamadas simultâneas e seria processado mais rápido.

> Nesse curso, não faremos essa implementação. Trouxemos essa discussão parque você possa entender um pouco mais sobre como poderíamos evoluir em alguns cenários.

Lembrando que cada discussão é valida para um tipo de produto específico que varia conforme as necessidades e objetivos. É essencial que você identifique a melhor opção para seu serviço.