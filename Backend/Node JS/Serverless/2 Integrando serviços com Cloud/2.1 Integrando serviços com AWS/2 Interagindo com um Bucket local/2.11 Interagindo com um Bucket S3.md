Nesta aula, nós utilizamos o [plugin `serverless-s3-local`](https://www.serverless.com/plugins/serverless-s3-local) em conjunto com o [plugin `serverless-offline`](https://www.serverless.com/plugins/serverless-offline) para criar um servidor que simula um Bucket S3 localmente. O `serverless-s3-local` utiliza a [biblioteca `s3rver`](https://github.com/jamhall/s3rver) por debaixo dos panos para criar o servidor.

Em seguida, utilizamos a [versão 3 da AWS SDK](https://github.com/aws/aws-sdk-js-v3) para nos comunicarmos com esse servidor. Essa biblioteca realmente é utilizada para se comunicar com um Bucket S3 real da AWS, mas podemos utilizá-la para interagir com o servidor S3 local também. Escrevemos as funções `criaClienteS3Local`, `fazUploadNoBucket` e `obtemDadosDoCsvDoBucket` para isso:

```js
const { S3Client, PutObjectCommand } = require("@aws-sdk/client-s3");


function criaClienteS3Local() {
  return new S3Client({
    forcePathStyle: true,
    credentials: {
      accessKeyId: "S3RVER",
      secretAccessKey: "S3RVER"
    },
    endpoint: "http://localhost:4569"
  });
}


async function fazUploadNoBucket() {
  const cliente = criaClienteS3Local();


  const comandoUpload = new PutObjectCommand({
    Bucket: "alunos-csv-local",
    Key: "teste.csv",
    Body: Buffer.from("12345")
  });


  await cliente.send(comandoUpload);
}


async function obtemDadosDoCsvDoBucket(nome, chave) {
  const cliente = criaClienteS3Local();


  const comando = new GetObjectCommand({
    Bucket: nome,
    Key: chave
  });


  const resposta = await cliente.send(comando);
  const dadosCsv = await resposta.Body.transformToString("utf-8");


  return dadosCsv;
}
```

Além disso, configuramos a seguinte função no `serverless.yml`:

```yaml
  cadastrarAlunos:
    handler: index.cadastrarAlunos
    events:
      - s3:
          bucket: alunos-csv-local
          event: s3:ObjectCreated:*
          rules:
            - suffix: .csv
```

Marque as afirmações corretas a respeito dos códigos acima: