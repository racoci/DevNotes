# 2.08 Deletando livros

Após realizarmos operações para buscar livros, alterar seus registros e criar um novo livro, a última operação bastante comum que vamos realizar é a **exclusão de um registro**. Seja um livro, uma postagem em uma rede social, uma inscrição, etc.

Já que utilizamos `app.put`, `app.post` e `app.get` para as operações anteriores, para realizar a exclusão, utilizaremos `app.delete`.

Os métodos `delete`, `post` e `put` são provenientes do _Express_. Os parâmetros para o `app.delete` são exatamente os mesmos das outras operações. O primeiro parâmetro será uma _string_ com a rota que será acessada com o método `delete`. Será algo como `"/livros/:id"`, onde id é o identificador único do livro que desejamos excluir.

O segundo parâmetro é uma função que recebe `req` e `res` (requisição e resposta, respectivamente). Como estamos ainda utilizando um _array_ do _JavaScript_, continuaremos a usar os métodos nativos para manusear esse _array_.

```javascript
app.delete("/livros/:id", (req, res) => {
  // código
});
```

Exemplo de como a função poderia ser implementada:

```javascript
app.delete('/livros/:id', (req, res) => {
  const index = buscaLivro(req.params.id);
  livros.splice(index, 1);
  res.status(200).send('Livro removido com sucesso.');
});
```

Como você pode observar acima, utilizamos a mesma função `buscaLivro` que utilizamos nas operações anteriores para localizar o índice do livro pelo id no _array_. Copiaremos da função `app.put` a linha que contém a chamada da função `buscaLivro(req.params.id)` e a inseriremos dentro do `app.delete`.

Uma vez que temos o índice do livro, podemos deletá-lo utilizando o método nativo do _JavaScript_ `splice`, que consegue localizar um elemento em qualquer parte do _array_ e deletá-lo.

Como queremos só deletar o registro, passaremos dois parâmetros para o `splice`: o primeiro será o `index` e depois `1`, pois queremos deletar apenas um elemento do _array_.

```javascript
app.delete('/livros/:id', (req, res) => {
    const index = buscaLivro(req.params.id);
    livros.splice(index, 1);
    
})
```

No final da operação, precisamos enviar uma resposta, que pode ser um status 200 (OK) ou 204 (Sem conteúdo). Optei por utilizar o status 200 e mandar uma mensagem informando que o livro foi removido com sucesso. A resposta será então `res.status(200)`.

Em seguida, usaremos `.send` em vez de `.json`, pois não tem motivo para retornarmos algum objeto nesse caso. Dentro de `.send` passaremos a mensagem `"livro removido com sucesso"`.

Como sempre, após realizar mudanças no código, é importante testar se elas estão funcionando conforme o esperado. Portanto, primeiro verificaremos se o servidor está funcionando corretamente, e em seguida utilizaremos o _Postman_ para testar a operação que acabamos de criar.

No _Postman_, faremos um `GET` para buscar todos os livros e verificar se o _array_ é retornado corretamente. Em seguida, realizaremos um `POST` para criar um novo livro, e por fim, realizaremos um `DELETE` para excluir um dos livros.

O método POST é usado para criar um novo livro. Durante este processo, nós utilizamos o corpo da requisição, formatado em JSON, para que o Postman envie um novo registro de livro. Ao clicar em "Send", um novo teste será realizado.

Quando o Postman retorna, ele também mostra o status code utilizado, neste caso foi o 201 ("Created"), usado quando um novo registro é criado. Com isso, o livro foi cadastrado com sucesso.

Em seguida, implementamos o método GET para obter um livro. No exemplo, vou solicitar o livro 3, que acabamos de criar. Então, utilizando o get, combinado com a URL "[http://localhost:3000/livros/3](http://localhost:3000/livros/3)", e ao apertar "Send", o Postman retorna apenas o objeto livro criado.

Agora podemos testar rapidamente os dois últimos métodos, PUT e DELETE. Vou solicitar a alteração do livro 1, que já havíamos criado anteriormente, alterando a URL para "[http://localhost:3000/livros/1](http://localhost:3000/livros/1)".

No caso de alteração, precisamos enviar, via corpo da requisição, os novos dados que desejamos substituir. Mantenho as informações anteriores e apenas altero o título. Ao clicar em "Send", o título é modificado e retorna o array completo, conforme solicitado quando criamos o método PUT.

Por último, vamos testar o DELETE. Para isso, vou copiar a URL "[http://localhost:3000/livros/1](http://localhost:3000/livros/1)" para utilizá-la no método DELETE. Após selecionar o método delete e colar a URL, vamos solicitar a exclusão do livro 1, que é "O Senhor dos Anéis".

Nesse processo, não é necessário enviar nada no corpo da requisição. Ao clicar em "Send", o retorno é "Livro removido com sucesso". Agora, se retornarmos à requisição GET e fizermos uma nova solicitação apenas para `/livros`, o livro de id 1, "O Senhor dos Anéis", deverá ter sido removido do array. Após o teste, o resultado é o seguinte:

```json
{
    "id": 2,
    "titulo": "O Hobbit"
},
{
    "id": 3,
    "titulo": "O Silmarillion"
}
```

O teste foi bem-sucedido, agora no array só contém o livro de id 2 e o livro de id 3.

Portanto, todo o nosso processo foi bem-sucedido e todas as operações que podemos realizar em um registro foram concluídas. O que fizemos nesta aula é conhecido como **CRUD**, que é um acrônimo que representa as operações básicas que são realizadas em um banco ou com um registro, que são:

- Criar (_Create_)
- Ler (_Read_)
- Alterar (_Update_)
- Deletar (_Delete_)

O "C" de criar é realizado pelo POST, o "R" de _read_ (ler) é feito pelo GET, o "U" de _update_ (atualizar) é feito pelo PUT e o "D" de _delete_ (deletar) é feito pelo DELETE. Portanto, o CRUD é uma das bases do back-end, que engloba basicamente tudo o que fazemos com um registro.

Se você pensar bem, quando interage com uma página da internet, é, em essência, o que nós fazemos. Nós obtemos registros, criamos coisas, alteramos o que criamos e deletamos o que também criamos.

Você pode encontrar mais informações sobre o CRUD nas atividades extras. Agora nós vamos continuar evoluindo a nossa API e utilizando mais métodos do Express, agora com um banco de dados, para conseguirmos salvar o que estamos criando.

Vamos em frente!