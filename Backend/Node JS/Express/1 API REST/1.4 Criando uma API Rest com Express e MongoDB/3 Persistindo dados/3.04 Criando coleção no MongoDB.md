Neste curso, vamos utilizar um serviço do MongoDB chamado _Atlas_, ou _Mongo Atlas_. Este é um serviço de armazenamento de bancos de dados Mongo na nuvem. Dessa forma, não precisaremos instalar o banco de dados localmente, nem hospedá-lo em um servidor local.

Entre os materiais deste curso, há algumas instruções iniciais para a criação de sua conta no [site do MongoDB](https://www.mongodb.com/pt-br). Agora, vamos criar uma instância gratuita.

## Criando uma Instância do MongoDB

Vamos ao navegador, no qual devemos estar conectados à conta, na qual criamos uma organização chamada Alura. Contudo, você pode nomeá-la como preferir.

Vamos acessar essa organização. Na página "Projects", daremos início ao primeiro projeto ao clicar em "New Project", botão localizado à direita do título da página. Recomendamos que você acompanhe o processo.

> Depois do vídeo, haverá uma atividade explicativa em texto para ser consultada, caso tenha alguma dificuldade, ou caso a interface do Atlas tenha sido modificada após a gravação do curso.

Ainda assim, é importante acompanhar o vídeo, pois o procedimento deverá ser igual.

Ao clicar em "New Project", veremos a página "Create a Project" com duas guias: "Name your Project" (Nomeie seu projeto) e "Add members" (Adicione membros). Na primeira, haverá um campo de texto para o nome do projeto. Vamos nomeá-lo de "Livraria" e, em seguida, clicaremos em "Next" (Próximo), o que nos levará para a segunda guia.

No que diz respeito à adição de membros, não será necessário adicionar ninguém para o contexto deste projeto, pois trata-se de um exemplo para nosso aprendizado. Portanto, apenas vamos prosseguir clicando no botão "Create Project" (Criar Projeto), no canto inferior direito da página.

Após criado o projeto, será direcionada para a tela "Database Deployments" (Implantação da Base de dados) para criar uma nova base de dados. Vamos clicar no botão "Build a Database", no centro da página.

Seremos direcionados à página "Deploy your database" (Implante sua base de dados), na qual haverá uma seção com algumas opções de custo apresentadas. Vamos escolher a última opção à esquerda: "Free", que é gratuita.

Na seção "Provider" (Provedor), abaixo da anterior, manteremos o _Provider_, como AWS, que já estará selecionado. Não é necessário realizar nenhuma alteração. No campo "Name", é possível nomear o _cluster_ (grupo de dados), mas manteremos o nome padrão, que é "Cluster0".

Manteremos o campo da seção "Tag" vazio, sem adicionar nenhuma _tag_. No final da página haverá a seção "Free", com o botão "Create". Clicaremos nele para seguir adiante e sermos direcionados para a página "Security Quickstart" (Inicialização Rápida de Segurança".

Nesta página, forneceremos os dados de acesso a esse banco de dados. Existe mais de uma forma de fazer isso.

Optaremos pelo acesso mais simples, que é somente com _Username_ (nome de pessoa usuária) e _Password_ (senha). Para isso, na seção 1, clicaremos na opção "Username and Password" à esquerda da opção "Certificate" (certificado).

No campo _Username_, escreveremos "admin" e em _Password_, escreveremos "admin123", para lembrarmos facilmente. Este banco será usado apenas localmente e, provavelmente, quando você estiver assistindo a este curso, ele já terá sido excluído.

Por fim, clicaremos no botão verde "Create User" para criar o login com esses dados e desceremos para a seção 2, que inicialmente nos indaga por onde queremos nos conectar.

A conexão ao banco de dados será feita através do meu ambiente local. Portanto, manteremos a seleção da opção "My Local Environment" (meu ambiente local), à esquerda de "Cloud Environment" (ambiente em nuvem).

A última parte de configuração na seção 2 consiste em selecionar os IPs que terão acesso ao banco. Será adicionado automaticamente o IP "177.8.171.44/32" na lista, contudo, adicionaremos outro, escrevendo "0.0.0.0/0" e clicando no botão "Add Entry" (adicionar entrada).

Este número de IP permite o acesso ao banco de qualquer lugar. Vamos manter esse acesso livre, por enquanto. Este não é um procedimento recomendado para produção, mas é comum em bases de dados para estudos, e serve para facilitar a configuração do banco. Posteriormente,você pode deletar o seu banco.

Após a adição deste IP, clicaremos no botão "Finish and Closed" (Finalizar e Fechar), no canto inferior direito da página.

Após o clique, seremos parabenizados pela criação do primeiro banco de dados em uma janela modal, na qual clicaremos em "Go to Database" (Ir para a Base de dados) para voltar à página "Database Deployments", onde deverá aparecer o "Cluster0".

O que criamos no processo anterior consiste em um banco de dados do MongoDB, hospedado em um serviço em nuvem fornecido gratuitamente pela própria empresa. Precisamos agora conectar esse banco à API.

## Conectando o Banco à API

À direita do nome "Cluster0", vamos clicar no botão "Connect" (Conectar). Ele abrirá uma janela modal com algumas opções para conectar a API ao banco de dados que acabamos de criar na nuvem.

Clicaremos na primeira opção, chamada "Drivers", para fazer a conexão por meio das bibliotecas do MongoDB em nosso projeto e através da _connection string_ (string de conexão).

Após o clique, iremos para a etapa "Connecting with MongoDB Driver" (Conectando-se com o Driver do MongoDB). A primeira coisa que vamos fazer é selecionar o driver e a versão nos campos de lista selecionáveis "Driver" e "Version". Nesse caso, vamos usar o Node.js na versão 5.5 ou posterior, que é a mais recente, portanto, selecionaremos "Node.js" no primeiro campo e "5.5 or later" no segundo.

Agora, vamos instalar o Driver do MongoDB. Basicamente instalaremos a biblioteca ou dependência do MongoDB em nosso projeto com o conhecido comando `npm install`. Para isso, copiaremos a linha que a plataforma fornece na seção 2, "Install your driver" (Instale seu driver):

```plaintext
npm install mongodb
```

Acessando novamente o terminal do computador, faremos um "Ctrl+C" para derrubar o servidor local. Lembrando que ao fazer instalações, precisamos necessariamente derrubar o servidor e reativá-lo.

Vamos colar e rodar no terminal o comando `npm install mongodb` para instalar. Após a conclusão desse processo, voltaremos à janela modal da plataforma do MongoDB, onde já completamos a etapa 2 de instalar a dependência do MongoDB em nosso projeto.

A última etapa, a 3, envolve a _connection string_ (string de conexão) que o Atlas fornece. Uma _connection string_ é basicamente o endereço que usaremos para conectar nossa base de dados à aplicação. Esse tipo de abordagem é muito comum para conexões de bancos de dados, não apenas para o Mongo.

Vamos copiar a linha que o Mongo Atlas está fornecendo na seção 3 e fechar a janela modal pressionando o botão "Close" (Fechar), no canto inferior direito.

```plaintext
mongodb+srv://admin: <password>@cluster0.uvmwiwx.mongodb.net/?retryWrites=true&w=majority
```

Vamos voltar ao projeto pelo Visual Studio Code. Podemos colar esta _connection string_ no arquivo `app.js`, abaixo do `export default app`. Vamos comentá-la, apenas para salvá-la e podermos usar mais tarde.

```javascript
// Código omitido

export default app

// mongodb+srv://admin: <password>@cluster0.uvmwiwx.mongodb.net/?retryWrites=true&w=majority
```

Por enquanto, não iremos à API. Voltando à página do MongoDB no navegador, vamos criar pelo próprio Mongo Atlas um primeiro registro, para termos acesso ao nosso banco com pelo menos um documento e seu registro.

Nossa base de dados "Livraria" existe, mas ainda não contém nenhuma _**coleção**_. O que é uma coleção?

Um banco MongoDB é composto por coleções de documentos. Em uma livraria, "Livros" é uma coleção de livros, "Autores" é uma coleção de autores. Vamos criar a nossa primeira coleção.

Para isso, vamos clicar na opção "Browse Collections" (navegar por coleções), à direita do nome "Cluster0" e dos botões "Connect" e "View Monitoring". Essa ação nos redirecionará para a página do "Cluster0" e acessará a guia "Collections".

Ainda não temos nenhuma coleção, mas se descermos a página da guia "Collections", temos um botão que diz "Add My Own Data" (Adicionar meus próprios dados). Vamos clicar nele para abrir a janela modal "Create Database" (Criar Base de dados), que possui três campos digitáveis: "Database name" (Nome da Base de dados), "Collection name" (Nome da coleção) e "Additional Preferences" (Preferências adicionais).

O nome da base de dados será "livraria" e o nome da coleção, por se tratar de uma coleção de livros, será "livros". Não necessitamos de nenhuma preferência adicional, portanto manteremos esse campo vazio. Por fim, clicaremos em "Create", no canto inferior direito do modal.

Aguardaremos um momento para carregar a guia "Collections". Após esse processo, vemos agora a nossa coleção "livraria.livros". Se trata de um nome de objeto, portanto, vemos a estrutura de objetos, separando o banco e a coleção por um ponto.

Ainda não temos nenhum documento, portanto, clicaremos no botão "Insert Document" (Inserir Documento), no canto direito da página. O clique abrirá a janela modal "Insert Document", na qual veremos uma estrutura de objeto.

|#|#|#|
|---|---|---|
|1|_id: 64c2a45ad5a0d7f958add9e0|ObjectId|
|2|: " "|String|

Por meio dessa janela, o MongoDB nos permite criar e adicionar um livro na nossa base. Como se trata de um livro, começaremos adicionando um `titulo` do tipo `String` na linha 2, à esquerda dos dois pontos. Esse título será `"O Senhor dos Anéis"`.

|#|#|#|
|---|---|---|
|1|_id: 64c2a45ad5a0d7f958add9e0|ObjectId|
|2|titulo: "O Senhor dos Anéis "|String|

Além do título, um livro pode ter um autor, mas não vamos adicionar neste momento. Vamos clicar no botão "+" abaixo do número das linhas para criar a linha 3, na qual vamos dizer que esse livro tem uma `editora`, que chamaremos de "Editora Clássicos", apenas para não mencionar um nome real.

Criaremos a linha 5, na qual definiremos um preço de `10`reais, para que o livro seja bem acessível.

Por fim, podemos também definir o número de páginas. Criaremos mais uma linha com o campo `paginas`, que receberá o valor de `200` páginas.

Vamos clicar nos campos de tipos correspondentes aos campos de preço e de páginas, inicialmente marcados como _String_, e alterá-los para _Int32_, que representa um tipo numérico. Isso permite que possamos fazer operações com esses números.

|#|#|#|
|---|---|---|
|1|_id: 64c2a45ad5a0d7f958add9e0|ObjectId|
|2|titulo: "O Senhor dos Anéis "|String|
|3|editora: "Classicos"|String|
|4|preco: 10|Int32|
|5|paginas: 200|Int32|

Portanto, teremos duas informações em formato de _String_, sendo elas _Título_ e _Editora_, e outras duas em formato numérico, _Preço_ e _Páginas_.

Clicaremos no botão "Insert", no canto inferior direito do modal, e um novo livro será criado em nossa base de dados. Veremos na seção da coleção "livraria.livros" o seguinte documento:

```plaintext
_id: ObjectId('64c2a45ad5a0d7f958add9e0')
titulo: "O Senhor dos Anéis"
editora: "Classicos"
preco: 10
paginas: 200
```

Ao criar um novo livro, é gerado automaticamente um documento correspondente dentro da coleção de livros. Cada documento consiste em um livro único com um _ID_ próprio, um título, uma editora, preço e número de páginas.

Criamos um banco de dados do MongoDB na nuvem. Já inserimos até mesmo um registro, de modo que, ao conectarmos o banco à nossa API, já devemos conseguir recuperar esse registro do banco de dados e fazê-lo aparecer no Postman.

Agora, vamos aprender como conectar as duas partes.