# 3.08 Criando models e schemas

Agora que a conexão entre o banco de dados e a API foi estabelecida com sucesso, vamos manipular esses dados na API. Vale lembrar que já temos um livro na nossa coleção de livros.

Neste vídeo, vamos alterar bastante código no `app.js` e criar alguns outros códigos para substituir o que fizemos anteriormente para lidar com o _array_ local, que agora será tratado pelo Mongoose e pelo MongoDB.

Para começar, antes de alterarmos o `app.js`, criaremos um modelo do livro com o qual desejamos trabalhar. Por meio do explorador, vamos selecionar a pasta _source_ e criar outra pasta dentro dela, chamada "models". Dentro da pasta nova, criaremos um arquivo chamado `Livro.js`, com "L" maiúsculo.

No interior desse arquivo, criaremos literalmente um modelo para qualquer livro que entre no banco, baseando-nos também nos métodos do Mongoose.

No topo do arquivo, como sempre, vamos importar o `mongoose from "mongoose"`.

```javascript
import mongoose from "mongoose"
```

Abaixo dessa linha, vamos criar o modelo. Além dele, também criaremos algo que chamamos de _schema_ (esquema).

Primeiro, vamos criar nossa constante chamada `livroSchema` e atribuí-la como igual a `new Mongoose.Schema()`, com "S" maiúsculo. Ela é uma função que vai receber alguns parâmetros.

Antes de começarmos a preencher o método `Schema()`, com parâmetros, devemos entender: o que é um esquema nesse contexto?

## Definindo o _Schema_

Um _Schema_ é um objeto de configuração que será usado para o Mongoose definir internamente a estrutura e as propriedades de um livro, um autor ou qualquer outro documento.

Neste caso, vamos passar para o Mongoose quais as propriedades que um livro precisa ter: autor, título, preço, descrição, o que quisermos. Ou seja, a descrição de um documento livro numa coleção de livros.

O parâmetro que passaremos dentro da função `Schema()` é um objeto, ou seja, um par de chaves (`{}`). Este possuirá as propriedades do nosso objeto livro, ou seja, entre as chaves, vamos adicionar as propriedades, começando pelo `id`, que receberá outro par de chaves.

Dentro do objeto de `id`, informaremos especificações do Mongoose. A primeira será a propriedade `type`, que se refere ao tipo do dado. Ela receberá um `mongoose.Schema.Types.ObjectId`, onde `ObjectId` é um tipo do MongoDB, usado para a criação de IDs únicos.

```javascript
import mongoose from "mongoose"

const livroSchema = new mongoose.Schema ({
    id: { type: mongoose.Schema.Types.ObjectId },

});
```

Abaixo de `id`, adicionaremos as propriedades do livro em si. O livro possui um `titulo`, que é normalmente uma string. Portanto, ele receberá um objeto por meio de um par de chaves e dentro deste, um `type` que será `mongoose.Schema.Types.String`. Neste caso, podemos passar somente `String`, com "S" maiúsculo, para simplificar.

No mesmo objeto, definiremos também a propriedade `required: true`, o que significa que a propriedade `titulo` é obrigatória. Ou seja, não conseguimos criar um livro sem passar o título dele.

Existem propriedades que não precisam ser obrigatórias, por exemplo, o número de páginas. Contudo, o título é fundamental.

Abaixo de `titulo`, definiremos as propriedades de editora, preço e número de páginas. Em todas elas, adicionaremos um par de chaves e um `type:` entre elas. a editora será do tipo `String`, enquanto as duas últimas são do tipo `Number`.

Abaixo, temos o código completo deste arquivo até agora.

```javascript
import mongoose from "mongoose"

const livroSchema = new mongoose.Schema ({
    id: { type: mongoose.Schema.Types.ObjectId },
    titulo: { type: String, required: true },
    editora: { type: String },
    preco: { type: Number },
    paginas: { type: Number }
});
```

Com isso, temos um esquema de um livro, ou seja, uma estrutura com todas as propriedades de um livro.

À direita do objeto `livroSchema` delimitado pelo bloco de chaves, adicionaremos o outro parâmetro do nosso `mongoose.schema`, que também será um objeto e, portanto, terá um par de chaves, entre as quais informaremos apenas uma propriedade, que será `versionKey: false`.

Esta `versionKey` está relacionada ao versionamento do MongoDB, que é uma funcionalidade um pouco mais avançada e que nós não configuraremos aqui. Ela foi adicionada apenas para informar que não desejamos versionar o nosso esquema.

```javascript
import mongoose from "mongoose"

const livroSchema = new mongoose.Schema ({
    id: { type: mongoose.Schema.Types.ObjectId },
    titulo: { type: String, required: true },
    editora: { type: String },
    preco: { type: Number },
    paginas: { type: Number }
}, { versionKey: false });
```

A partir deste esquema, podemos criar o nosso modelo `Livro`.

## Criando um Modelo do Livro

Abaixo da definição do esquema, vamos criar uma nova constante, chamada simplesmente de `livro`, com "l" minúsculo, que será igual a `mongoose.model`, com "m" minúsculo.

Esse método vai receber dois parâmetros:`"livros"` e `livroSchema`. O primeiro será uma _string_ referente à coleção. Criamos uma coleção `livros` no banco de dados, a qual iremos referenciar como _string_.

O segundo parâmetro informará para o modelo qual é a coleção a que ele se refere e qual é o esquema deste livro, ou seja, quais são suas propriedades.

No final do arquivo, adicionaremos o `export default livro`, que exporta o modelo `livro` para que possa ser usado pelo restante da aplicação.

```javascript
import mongoose from "mongoose"

const livroSchema = new mongoose.Schema ({
    id: { type: mongoose.Schema.Types.ObjectId },
    titulo: { type: String, required: true },
    editora: { type: String },
    preco: { type: Number },
    paginas: { type: Number }
}, { versionKey: false });

const livro = mongoose.model("livros", livroSchema);

export default livro;
```

_Models_ (modelos) e _Schemas_ (esquemas) são conceitos que não são exclusivos do Mongoose. Eles estão relacionados a APIs e bancos de dados. Você encontrará muitos tipos diferentes de modelos e esquemas para vários tipos de conexão com o banco enquanto estiver criando suas APIs.

No caso do Mongoose, isso é a maneira que ele tem de definir um esquema e um modelo.

Mas, afinal, _**o que é um modelo?**_

Neste caso, o modelo é um objeto que representa uma coleção e um banco de dados. O modelo em si é uma interface que permite à API interagir com os documentos de uma coleção. Ou seja, temos um modelo `Livro` como uma interface para que nossa API interaja com a coleção de livros que está no MongoDB.

Portanto, é o modelo que fornece para a API todos os métodos de que nós conseguiremos executar com o CRUD. O modelo é quem dirá à API que ela pode realizar o GET, o POST e a deleção de um livro.

A partir de agora, vamos usar o modelo e combiná-lo com o outro componente da API para finalmente acessar o nosso banco e trazer algum registro.

Vamos lá.